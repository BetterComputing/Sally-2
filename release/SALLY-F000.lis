SALLY-F000.asm:
     1                          ;--------------------------------------------------
     2                          ; Init Sequence
     3                          ;--------------------------------------------------
     4                          ; 50	01	Bit0	set ATARI DATA
     5                          ; 51	01 	Bit1	set RS232 TX
     6                          ; 80	03	CTC	Channel 0 reset
     7                          ; 80	10	CTC	Channel 0 interrupt vector
     8                          ; 81	07     	CTC	Channel 1 reset + set time constant
     9                          ; 81	01	CTC	Channel 1 time contant 1
    10                          ; 82	03 	CTC	Channel 2 reset
    11                          ; 83	03     	CTC	Channel 3 reset
    12                          ; 57	01	Bit7	ATARI 0=CMD / *** 1=RXD ***
    13                          ; 30	00 	DSE	Floppy Control (74LS273) 0=Drive1,  1=Drive2,  2=Drive3,  3=Drive4,  4=Reset FDC,  5=Side,  6=B\S,  7=S/D\
    14                          ; 40	d0      DWR/DRW	FDC read-write	d0 = force int (with no interrupt)
    15                          ;--------------------------------------------------
    16                          ; out\ ports
    17                          ;--------------------------------------------------
    18                          ; $2x 	Printer DATA
    19                          ; $3x	Port Floppy Control
    20                          ; $4x	FDC 1797
    21                          ; $5x	U52 74LS259
    22                          ; 	$50	ATARI Out data
    23                          ; 	$51	RS232 TX
    24                          ; 	$52	ROM switch
    25                          ; 	$53	printer strobe
    26                          ; 	$54	reset index-pulse
    27                          ; 	$55	RS232 DTR
    28                          ; 	$56	set index pulse
    29                          ; 	$57	0=CMD,  1=SIO
    30                          ; $8x	CTC
    31                          ;--------------------------------------------------
    32                          ; in\ ports
    33                          ;--------------------------------------------------
    34                          ; $2x	Printer Control
    35                          ; $4x	FDC 1797
    36                          ; $5x	RS232	D7=RX,  D3=1,  D2=?,  D1=FlowControl
    37                          ; $70	SIO	D7=RX,  D3=RDY/+5V, D1=CMD
    38                          ;--------------------------------------------------
    39                          ; FF10: Interrupt Table
    40                          ;--------------------------------------------------
    41                          
    42                               		ORG	0f000h
    43                          
    44   000000 c31bf0           jmpboot:    	jp	0f01bh				;wboot?			f000
    45   000003 c3de03           jmpSallyMon:   jp	sallymon        		;Sally Monitor		f003
    46   000006 c335f6               		jp	0f635h          		;const			f006
    47   000009 c340f6           jmpCONIN:    	jp	0f640h          		;conin			f009
    48   00000c c350f6           jmpCONOUT:    	jp	0f650h          		;conout			f00c
    49   00000f c322f0               		jp	0f022h          		;list			f00f
    50   000012 c3dcf4               		jp	0f4dch          		;punch			f012
    51   000015 c3ebf4               		jp	0f4ebh          		;reader			f015
    52   000018 c315f6               		jp	0f615h          		;home?		ATARI mode = f7e1 = return
    53                          
    54   00001b f3              f01b:     	di
    55   00001c af                   		xor	a
    56   00001d d352                 		out	(52h), a
    57   00001f c30000               		jp	0000h
    58   000022 cdcbf3               		call	0f3cbh
    59   000025 dd7e00               		ld	a, (ix+00h)
    60   000028 b7                   		or	a
    61   000029 284d                 		jr	z, f078		; (+4dh)
    62   00002b 0688                 		ld	b, 88h
    63   00002d 3d                   		dec	a
    64   00002e 287b                 		jr	z, f0ab		; (+7bh)
    65   000030 06a8                 		ld	b, 0a8h
    66   000032 3d                   		dec	a
    67   000033 2876                 		jr	z, f0ab		; (+76h)
    68   000035 3d                   		dec	a
    69   000036 285f                 		jr	z, f097		; (+5fh)
    70   000038 dd3608ff             		ld	(ix+08h), 0ffh
    71   00003c f3                   		di
    72   00003d 3ea7                 		ld	a, 0a7h
    73   00003f d383                 		out	(83h), a
    74   000041 af                   		xor	a
    75   000042 d383                 		out	(83h), a
    76   000044 3d                   		dec	a
    77   000045 32c9ff               		ld	(0ffc9h), a
    78   000048 2150f0               		ld	hl, 0f050h
    79   00004b 2216ff               		ld	(0ff16h), hl
    80   00004e fb                   		ei
    81   00004f c9                   		ret
    82                          
    83   000050 f5                   		push	af
    84   000051 3ac9ff               		ld	a, (0ffc9h)
    85   000054 3d                   		dec	a
    86   000055 32c9ff               		ld	(0ffc9h), a
    87   000058 200a                 		jr	nz, f064		; (+0ah)
    88   00005a cd68f0               		call	0f068h
    89   00005d 3e21                 		ld	a, 21h
    90   00005f d383                 		out	(83h), a
    91   000061 322eff               		ld	(0ff2eh), a
    92   000064 f1              f064:		pop	af
    93   000065 fb                   		ei
    94   000066 ed4d                 		reti
    95                          
    96   000068 db41                 		in	a, (41h)
    97   00006a d343                 		out	(43h), a
    98   00006c 3e10                 		ld	a, 10h
    99   00006e d340                 		out	(40h), a
   100   000070 3a2fff               		ld	a, (0ff2fh)
   101   000073 e6f0                 		and	0f0h
   102   000075 d330                 		out	(30h), a
   103   000077 c9                   		ret
   104                          
   105   000078 cd1af1          f078:		call	0f11ah
   106   00007b cb7f                 		bit	7, a
   107   00007d 2805                 		jr	z, f084		; (+05h)
   108   00007f 2130ff               		ld	hl, 0ff30h
   109   000082 3600                 		ld	(hl), 00h
   110   000084 dd7708          f084:		ld	(ix+08h), a
   111   000087 3a2fff               		ld	a, (0ff2fh)
   112   00008a dd7706               		ld	(ix+06h), a
   113   00008d 3a30ff               		ld	a, (0ff30h)
   114   000090 dd7707               		ld	(ix+07h), a
   115   000093 cd3cf0               		call	0f03ch
   116   000096 c9                   		ret
   117                          
   118   000097 dd360606        f097:		ld	(ix+06h), 06h
   119   00009b dd360700             		ld	(ix+07h), 00h
   120   00009f 06c0                 		ld	b, 0c0h
   121   0000a1 cdb3f0               		call	0f0b3h
   122   0000a4 3a2fff               		ld	a, (0ff2fh)
   123   0000a7 dd7706               		ld	(ix+06h), a
   124   0000aa c9                   		ret
   125                          
   126   0000ab ddcb017e        f0ab:		bit	7, (ix+01h)
   127   0000af 2802                 		jr	z, f0b3		; (+02h)
   128   0000b1 cbc8                 		set	1, b
   129   0000b3 78              f0b3:		ld	a, b
   130   0000b4 32c5ff               		ld	(0ffc5h), a
   131   0000b7 cd1af1               		call	0f11ah
   132   0000ba cb7f                 		bit	7, a
   133   0000bc 2052                 		jr	nz, f110		; (+52h)
   134   0000be 3a2dff               		ld	a, (0ff2dh)
   135   0000c1 feff                 		cp	0ffh
   136   0000c3 2805                 		jr	z, f0ca		; (+05h)
   137   0000c5 ddbe02               		cp	(ix+02h)
   138   0000c8 2805                 		jr	z, f0cf		; (+05h)
   139   0000ca cdf8f1          f0ca:		call	0f1f8h
   140   0000cd 2041                 		jr	nz, f110		; (+41h)
   141   0000cf 3a12ff          f0cf:		ld	a, (0ff12h)
   142   0000d2 3c                   		inc	a
   143   0000d3 20fa                 		jr	nz, f0cf		; (-06h)
   144   0000d5 f3                   		di
   145   0000d6 3e03                 		ld	a, 03h
   146   0000d8 d380                 		out	(80h), a
   147   0000da 3e27                 		ld	a, 27h
   148   0000dc d382                 		out	(82h), a
   149   0000de 3e3d                 		ld	a, 3dh
   150   0000e0 d382                 		out	(82h), a
   151   0000e2 21a8f3               		ld	hl, 0f3a8h
   152   0000e5 2216ff               		ld	(0ff16h), hl
   153   0000e8 3a33ff               		ld	a, (0ff33h)
   154   0000eb 32c6ff               		ld	(0ffc6h), a
   155   0000ee dd7e03          f0ee:		ld	a, (ix+03h)
   156   0000f1 d342                 		out	(42h), a
   157   0000f3 dd7e02               		ld	a, (ix+02h)
   158   0000f6 d341                 		out	(41h), a
   159   0000f8 3ac5ff               		ld	a, (0ffc5h)
   160   0000fb d340                 		out	(40h), a
   161   0000fd cdb5f2               		call	0f2b5h
   162   000100 280e                 		jr	z, f110		; (+0eh)
   163   000102 f5                   		push	af
   164   000103 cd0ef3               		call	0f30eh
   165   000106 c1                   		pop	bc
   166   000107 2006                 		jr	nz, f10f		; (+06h)
   167   000109 21c6ff               		ld	hl, 0ffc6h
   168   00010c 35                   		dec	(hl)
   169   00010d 20df                 		jr	nz, f0ee		; (-21h)
   170   00010f 78              f10f:		ld	a, b
   171   000110 dd7708          f110:		ld	(ix+08h), a
   172   000113 cd18f0               		call	0f018h
   173   000116 cd3cf0               		call	0f03ch
   174   000119 c9                   		ret
   175                          
   176   00011a dd7e01               		ld	a, (ix+01h)
   177   00011d cbbf                 		res	7, a
   178   00011f fe04                 		cp	04h
   179   000121 306b                 		jr	nc, f18e		; (+6bh)
   180   000123 0600                 		ld	b, 00h
   181   000125 4f                   		ld	c, a
   182   000126 212cff               		ld	hl, 0ff2ch
   183   000129 96                   		sub	(hl)
   184   00012a f5                   		push	af
   185   00012b 50                   		ld	d, b
   186   00012c 5e                   		ld	e, (hl)
   187   00012d 71                   		ld	(hl), c
   188   00012e 2120ff               		ld	hl, 0ff20h
   189   000131 19                   		add	hl, de
   190   000132 3a2dff               		ld	a, (0ff2dh)
   191   000135 77                   		ld	(hl), a
   192   000136 1e04                 		ld	e, 04h
   193   000138 19                   		add	hl, de
   194   000139 3a2fff               		ld	a, (0ff2fh)
   195   00013c 77                   		ld	(hl), a
   196   00013d 2120ff               		ld	hl, 0ff20h
   197   000140 09                   		add	hl, bc
   198   000141 7e                   		ld	a, (hl)
   199   000142 322dff               		ld	(0ff2dh), a
   200   000145 19                   		add	hl, de
   201   000146 d1                   		pop	de
   202   000147 7e                   		ld	a, (hl)
   203   000148 b7                   		or	a
   204   000149 201f                 		jr	nz, f16a		; (+1fh)
   205   00014b 2198f1               		ld	hl, 0f198h
   206   00014e 09                   		add	hl, bc
   207   00014f 7e                   		ld	a, (hl)
   208   000150 d330                 		out	(30h), a
   209   000152 f5                   		push	af
   210   000153 cd9cf1               		call	0f19ch
   211   000156 c1                   		pop	bc
   212   000157 fede                 		cp	0deh
   213   000159 3033                 		jr	nc, f18e		; (+33h)
   214   00015b cbf0                 		set	6, b
   215   00015d feb5                 		cp	0b5h
   216   00015f 3006                 		jr	nc, f167		; (+06h)
   217   000161 cbb0                 		res	6, b
   218   000163 fe99                 		cp	99h
   219   000165 3827                 		jr	c, f18e		; (+27h)
   220   000167 78              f167:		ld	a, b
   221   000168 1600                 		ld	d, 00h
   222   00016a cbaf            f16a:		res	5, a
   223   00016c ddcb017e             		bit	7, (ix+01h)
   224   000170 2802                 		jr	z, f174		; (+02h)
   225   000172 cbef                 		set	5, a
   226   000174 d330            f174:		out	(30h), a
   227   000176 322fff               		ld	(0ff2fh), a
   228   000179 14                   		inc	d
   229   00017a 15                   		dec	d
   230   00017b c499f3               		call	nz, 0f399h
   231   00017e cd91f3               		call	0f391h
   232   000181 cb6f                 		bit	5, a
   233   000183 c0                   		ret	nz
   234                          
   235   000184 cd9cf1               		call	0f19ch
   236   000187 b7                   		or	a				;clear carry
   237   000188 2804            f188:     	jr	z, f18e				;jr	c, xxh
   238   00018a cd91f3               		call	0f391h				;if ATARI mode never executed
   239   00018d c9                   		ret
   240                          
   241   00018e af              f18e:		xor	a
   242   00018f d330                 		out	(30h), a
   243   000191 322fff               		ld	(0ff2fh), a
   244   000194 3e80                 		ld	a, 80h
   245   000196 b7                   		or	a
   246   000197 c9                   		ret
   247                          
   248   000198 010204               		ld	bc, 0402h
   249   00019b 08                   		ex	af, af'
   250   00019c af                   		xor	a
   251   00019d d356                 		out	(56h), a
   252   00019f 3c                   		inc	a
   253   0001a0 d354                 		out	(54h), a
   254   0001a2 db41                 		in	a, (41h)
   255   0001a4 d343                 		out	(43h), a
   256   0001a6 3e18                 		ld	a, 18h
   257   0001a8 d340                 		out	(40h), a
   258   0001aa cdbaf3               		call	0f3bah
   259   0001ad cd91f3               		call	0f391h
   260   0001b0 4f                   		ld	c, a
   261   0001b1 0606                 		ld	b, 06h
   262   0001b3 210000               		ld	hl, 0000h
   263   0001b6 22c7ff               		ld	(0ffc7h), hl
   264   0001b9 ed5bc7ff        f1b9:		ld	de, (0ffc7h)
   265   0001bd cde3f1               		call	0f1e3h
   266   0001c0 380d                 		jr	c, f1cf		; (+0dh)
   267   0001c2 cde3f1               		call	0f1e3h
   268   0001c5 3808                 		jr	c, f1cf		; (+08h)
   269   0001c7 10f0                 		djnz	f1b9		; (-10h)
   270   0001c9 2ac7ff               		ld	hl, (0ffc7h)
   271   0001cc b7                   		or	a
   272   0001cd ed52                 		sbc	hl, de
   273   0001cf cdcbf3          f1cf:		call	0f3cbh
   274   0001d2 af                   		xor	a
   275   0001d3 d354                 		out	(54h), a
   276   0001d5 3c                   		inc	a
   277   0001d6 d356                 		out	(56h), a
   278   0001d8 7d                   		ld	a, l
   279   0001d9 24                   		inc	h
   280   0001da 25                   		dec	h
   281   0001db 2802                 		jr	z, f1df		; (+02h)
   282   0001dd 3eff                 		ld	a, 0ffh
   283   0001df 3230ff          f1df:		ld	(0ff30h), a
   284   0001e2 c9                   		ret
   285                          
   286   0001e3 cd91f3          f1e3:		call	0f391h
   287   0001e6 a9                   		xor	c
   288   0001e7 e602                 		and	02h
   289   0001e9 2009                 		jr	nz, f1f4		; (+09h)
   290   0001eb 3ac8ff               		ld	a, (0ffc8h)
   291   0001ee fe08                 		cp	08h
   292   0001f0 38f1                 		jr	c, f1e3		; (-0fh)
   293   0001f2 37                   		scf
   294   0001f3 c9                   		ret
   295                          
   296   0001f4 79              f1f4:		ld	a, c
   297   0001f5 2f                   		cpl
   298   0001f6 4f                   		ld	c, a
   299   0001f7 c9                   		ret
   300                          
   301   0001f8 3a2dff               		ld	a, (0ff2dh)
   302   0001fb feff                 		cp	0ffh
   303   0001fd 2005                 		jr	nz, f204		; (+05h)
   304   0001ff cd37f2               		call	0f237h
   305   000202 202a                 		jr	nz, f22e		; (+2ah)
   306   000204 0601            f204:		ld	b, 01h
   307   000206 cd57f2               		call	0f257h
   308   000209 c8                   		ret	z
   309                          
   310   00020a 3005                 		jr	nc, f211		; (+05h)
   311   00020c cd37f2               		call	0f237h
   312   00020f 201d                 		jr	nz, f22e		; (+1dh)
   313   000211 0602            f211:		ld	b, 02h
   314   000213 cd57f2               		call	0f257h
   315   000216 c8                   		ret	z
   316                          
   317   000217 3815                 		jr	c, f22e		; (+15h)
   318   000219 216400               		ld	hl, 0064h
   319   00021c cd9ef3               		call	0f39eh
   320   00021f 2128ff               		ld	hl, 0ff28h
   321   000222 3a2cff               		ld	a, (0ff2ch)
   322   000225 85                   		add	a, l
   323   000226 6f                   		ld	l, a
   324   000227 34                   		inc	(hl)
   325   000228 7e                   		ld	a, (hl)
   326   000229 e603                 		and	03h
   327   00022b 20e4                 		jr	nz, f211		; (-1ch)
   328   00022d 35                   		dec	(hl)
   329   00022e 3eff            f22e:		ld	a, 0ffh
   330   000230 322dff               		ld	(0ff2dh), a
   331   000233 3e10                 		ld	a, 10h
   332   000235 b7                   		or	a
   333   000236 c9                   		ret
   334                          
   335   000237 3a2fff               		ld	a, (0ff2fh)
   336   00023a cbe7                 		set	4, a
   337   00023c d330                 		out	(30h), a
   338   00023e 060f                 		ld	b, 0fh
   339   000240 10fe            f240:		djnz	f240		; (-02h)
   340   000242 cba7                 		res	4, a
   341   000244 d330                 		out	(30h), a
   342   000246 0600                 		ld	b, 00h
   343   000248 10fe            f248:		djnz	f248		; (-02h)
   344   00024a cd91f3               		call	0f391h
   345   00024d 3e0b                 		ld	a, 0bh
   346   00024f cd6bf3               		call	0f36bh
   347   000252 ee04                 		xor	04h
   348   000254 e684                 		and	84h
   349   000256 c9                   		ret
   350                          
   351   000257 c5              f257:		push	bc
   352   000258 3a2dff               		ld	a, (0ff2dh)
   353   00025b 47                   		ld	b, a
   354   00025c dd4e02               		ld	c, (ix+02h)
   355   00025f cd75f2               		call	0f275h
   356   000262 cd95f2               		call	0f295h
   357   000265 c1                   		pop	bc
   358   000266 37                   		scf
   359   000267 c0                   		ret	nz
   360                          
   361   000268 db42                 		in	a, (42h)
   362   00026a 322dff               		ld	(0ff2dh), a
   363   00026d dd9602               		sub	(ix+02h)
   364   000270 c8                   		ret	z
   365                          
   366   000271 10e4                 		djnz	f257		; (-1ch)
   367   000273 b7                   		or	a
   368   000274 c9                   		ret
   369                          
   370   000275 78                   		ld	a, b
   371   000276 d341                 		out	(41h), a
   372   000278 79                   		ld	a, c
   373   000279 d343                 		out	(43h), a
   374   00027b 2128ff               		ld	hl, 0ff28h
   375   00027e 3a2cff               		ld	a, (0ff2ch)
   376   000281 85                   		add	a, l
   377   000282 6f                   		ld	l, a
   378   000283 7e                   		ld	a, (hl)
   379   000284 e603                 		and	03h
   380   000286 f618                 		or	18h
   381   000288 cd6bf3               		call	0f36bh
   382   00028b 7e                   		ld	a, (hl)
   383   00028c e6fc                 		and	0fch
   384   00028e 2600                 		ld	h, 00h
   385   000290 6f                   		ld	l, a
   386   000291 cd9ef3               		call	0f39eh
   387   000294 c9                   		ret
   388                          
   389   000295 3ec0                 		ld	a, 0c0h
   390   000297 cd62f3               		call	0f362h
   391   00029a e698                 		and	98h
   392   00029c c8                   		ret	z
   393                          
   394   00029d 3a2fff               		ld	a, (0ff2fh)
   395   0002a0 ee80                 		xor	80h
   396   0002a2 322fff               		ld	(0ff2fh), a
   397   0002a5 d330                 		out	(30h), a
   398   0002a7 213200               		ld	hl, 0032h
   399   0002aa cd9ef3               		call	0f39eh
   400   0002ad 3ec0                 		ld	a, 0c0h
   401   0002af cd62f3               		call	0f362h
   402   0002b2 e698                 		and	98h
   403   0002b4 c9                   		ret
   404                          
   405   0002b5 2a6600               		ld	hl, (0066h)
   406   0002b8 e5                   		push	hl
   407   0002b9 2a6800               		ld	hl, (0068h)
   408   0002bc e5                   		push	hl
   409   0002bd 21eda2               		ld	hl, 0a2edh
   410   0002c0 cb6f                 		bit	5, a
   411   0002c2 2801                 		jr	z, f2c5		; (+01h)
   412   0002c4 24                   		inc	h
   413   0002c5 226600          f2c5:		ld	(0066h), hl
   414   0002c8 216800               		ld	hl, 0068h
   415   0002cb 36c9                 		ld	(hl), 0c9h
   416   0002cd f3                   		di
   417   0002ce 3ec7                 		ld	a, 0c7h
   418   0002d0 d383                 		out	(83h), a
   419   0002d2 af                   		xor	a
   420   0002d3 d383                 		out	(83h), a
   421   0002d5 fb                   		ei
   422   0002d6 dd6e04               		ld	l, (ix+04h)
   423   0002d9 dd6605               		ld	h, (ix+05h)
   424   0002dc dd4606               		ld	b, (ix+06h)
   425   0002df 0e43                 		ld	c, 43h
   426   0002e1 dd7e07               		ld	a, (ix+07h)
   427   0002e4 cb3f                 		srl	a
   428   0002e6 280d                 		jr	z, f2f5		; (+0dh)
   429   0002e8 cb3f                 		srl	a
   430   0002ea 2806                 		jr	z, f2f2		; (+06h)
   431   0002ec 76              f2ec:		halt
   432   0002ed 20fd                 		jr	nz, f2ec		; (-03h)
   433   0002ef 76              f2ef:		halt
   434   0002f0 20fd                 		jr	nz, f2ef		; (-03h)
   435   0002f2 76              f2f2:		halt
   436   0002f3 20fd                 		jr	nz, f2f2		; (-03h)
   437   0002f5 76              f2f5:		halt
   438   0002f6 20fd                 		jr	nz, f2f5		; (-03h)
   439   0002f8 db40            f2f8:		in	a, (40h)
   440   0002fa cb47                 		bit	0, a
   441   0002fc 20fa                 		jr	nz, f2f8		; (-06h)
   442   0002fe 47                   		ld	b, a
   443   0002ff cdcbf3               		call	0f3cbh
   444   000302 78                   		ld	a, b
   445   000303 e1                   		pop	hl
   446   000304 226800               		ld	(0068h), hl
   447   000307 e1                   		pop	hl
   448   000308 226600               		ld	(0066h), hl
   449   00030b e6fd                 		and	0fdh
   450   00030d c9                   		ret
   451                          
   452   00030e 47                   		ld	b, a
   453   00030f e6e7                 		and	0e7h
   454   000311 2808                 		jr	z, f31b		; (+08h)
   455   000313 f5                   		push	af
   456   000314 cd91f3               		call	0f391h
   457   000317 f1                   		pop	af
   458   000318 e6e1                 		and	0e1h
   459   00031a c9                   		ret
   460                          
   461   00031b cb60            f31b:		bit	4, b
   462   00031d 2023                 		jr	nz, f342		; (+23h)
   463   00031f 3a33ff               		ld	a, (0ff33h)
   464   000322 21c6ff               		ld	hl, 0ffc6h
   465   000325 96                   		sub	(hl)
   466   000326 c8                   		ret	z
   467                          
   468   000327 3a2dff               		ld	a, (0ff2dh)
   469   00032a 47                   		ld	b, a
   470   00032b b7                   		or	a
   471   00032c 2004                 		jr	nz, f332		; (+04h)
   472   00032e 0e01                 		ld	c, 01h
   473   000330 1802                 		jr	f334		; (+02h)
   474   000332 3d              f332:		dec	a
   475   000333 4f                   		ld	c, a
   476   000334 c5              f334:		push	bc
   477   000335 cd75f2               		call	0f275h
   478   000338 d1                   		pop	de
   479   000339 43                   		ld	b, e
   480   00033a 4a                   		ld	c, d
   481   00033b cd75f2               		call	0f275h
   482   00033e cd95f2               		call	0f295h
   483   000341 c9                   		ret
   484                          
   485   000342 cd95f2          f342:		call	0f295h
   486   000345 2012                 		jr	nz, f359		; (+12h)
   487   000347 db42                 		in	a, (42h)
   488   000349 ddbe02               		cp	(ix+02h)
   489   00034c 200d                 		jr	nz, f35b		; (+0dh)
   490   00034e 3a33ff               		ld	a, (0ff33h)
   491   000351 21c6ff               		ld	hl, 0ffc6h
   492   000354 96                   		sub	(hl)
   493   000355 c8                   		ret	z
   494                          
   495   000356 3e10                 		ld	a, 10h
   496   000358 c9                   		ret
   497                          
   498   000359 3eff            f359:		ld	a, 0ffh
   499   00035b 322dff          f35b:		ld	(0ff2dh), a
   500   00035e cdf8f1               		call	0f1f8h
   501   000361 c9                   		ret
   502                          
   503   000362 cd89f3               		call	0f389h
   504   000365 c5                   		push	bc
   505   000366 016a18               		ld	bc, 186ah
   506   000369 1807                 		jr	f372		; (+07h)
   507   00036b cd89f3               		call	0f389h
   508   00036e c5                   		push	bc
   509   00036f 017c92               		ld	bc, 927ch
   510   000372 db40            f372:		in	a, (40h)
   511   000374 cb47                 		bit	0, a
   512   000376 280a                 		jr	z, f382		; (+0ah)
   513   000378 cd8bf3               		call	0f38bh
   514   00037b 0b                   		dec	bc
   515   00037c 78                   		ld	a, b
   516   00037d b1                   		or	c
   517   00037e 20f2                 		jr	nz, f372		; (-0eh)
   518   000380 3e10                 		ld	a, 10h
   519   000382 47              f382:		ld	b, a
   520   000383 cd91f3               		call	0f391h
   521   000386 78                   		ld	a, b
   522   000387 c1                   		pop	bc
   523   000388 c9                   		ret
   524                          
   525   000389 d340                 		out	(40h), a
   526   00038b 3e0e                 		ld	a, 0eh
   527   00038d 3d              f38d:		dec	a
   528   00038e 20fd                 		jr	nz, f38d		; (-03h)
   529   000390 c9                   		ret
   530                          
   531   000391 3ed0                 		ld	a, 0d0h
   532   000393 cd89f3               		call	0f389h
   533   000396 db40                 		in	a, (40h)
   534   000398 c9                   		ret
   535                          
   536   000399 2a32ff               		ld	hl, (0ff32h)
   537   00039c 2600                 		ld	h, 00h
   538   00039e af              f39e:		xor	a
   539   00039f 3d              f39f:		dec	a
   540   0003a0 20fd                 		jr	nz, f39f		; (-03h)
   541   0003a2 2b                   		dec	hl
   542   0003a3 7c                   		ld	a, h
   543   0003a4 b5                   		or	l
   544   0003a5 20f7                 		jr	nz, f39e		; (-09h)
   545   0003a7 c9                   		ret
   546                          
   547   0003a8 3ed0                 		ld	a, 0d0h
   548   0003aa d340                 		out	(40h), a
   549   0003ac 3e01                 		ld	a, 01h
   550   0003ae d383                 		out	(83h), a
   551   0003b0 2103f3               		ld	hl, 0f303h
   552   0003b3 e3                   		ex	(sp), hl
   553   0003b4 3e10                 		ld	a, 10h
   554   0003b6 b7                   		or	a
   555   0003b7 fb                   		ei
   556   0003b8 ed4d                 		reti
   557                          
   558   0003ba f3                   		di
   559   0003bb 3e87                 		ld	a, 87h
   560   0003bd d383                 		out	(83h), a
   561   0003bf 3efa                 		ld	a, 0fah
   562   0003c1 d383                 		out	(83h), a
   563   0003c3 21d2f3               		ld	hl, 0f3d2h
   564   0003c6 2216ff               		ld	(0ff16h), hl
   565   0003c9 fb                   		ei
   566   0003ca c9                   		ret
   567                          
   568   0003cb f3                   		di
   569   0003cc 3e01                 		ld	a, 01h
   570   0003ce d383                 		out	(83h), a
   571   0003d0 fb                   		ei
   572   0003d1 c9                   		ret
   573                          
   574   0003d2 e5                   		push	hl
   575   0003d3 fb                   		ei
   576   0003d4 2ac7ff               		ld	hl, (0ffc7h)
   577   0003d7 23                   		inc	hl
   578   0003d8 22c7ff               		ld	(0ffc7h), hl
   579   0003db e1                   		pop	hl
   580   0003dc ed4d                 		reti
   581                          
   582                          ;--------------------------------------------------
   583                          ; SALLY Monitor
   584                          ;--------------------------------------------------
   585                          ;f3de
   586   0003de 3e01            sallymon:     	ld	a, 01h
   587   0003e0 d352                 		out	(52h), a			;turn off ROM
   588   0003e2 cdfcf5               		call	0f5fch				;init receive at 9600 baud (T/C 0 interrupt)
   589   0003e5 cdc904               		call	printstr
   590   0003e8 0d0a53414c4c5931		db	"\r\n",  "SALLY1",  0
                00              
   591                          
   592   0003f1 21f103          monloop:	ld	hl,  monloop			;loop here
   593   0003f4 e5                   		push	hl
   594   0003f5 cdc904               		call	printstr
   595   0003f8 0d0a232000      		db	"\r\n# ",  0
   596                          
   597   0003fd cdb204          f3fd:		call	getchar
   598   000400 fe20                 		cp	20h
   599   000402 d8                   		ret	c				;
   600                          
   601   000403 4f                   		ld	c, a
   602   000404 af                   		xor	a
   603   000405 67                   		ld	h, a
   604   000406 6f                   		ld	l, a
   605   000407 29              f407:		add	hl, hl
   606   000408 29                   		add	hl, hl
   607   000409 29                   		add	hl, hl
   608   00040a 29                   		add	hl, hl
   609   00040b b5                   		or	l
   610   00040c 6f                   		ld	l, a
   611   00040d cdb204               		call	getchar
   612   000410 fe0d                 		cp	0dh
   613   000412 280c                 		jr	z, f420		; (+0ch)
   614   000414 cd83f4               		call	0f483h
   615   000417 30ee                 		jr	nc, f407		; (-12h)
   616   000419 cdc9f4          f419:		call	0f4c9h
   617   00041c 203f00          		db	" ?",  0
   618   00041f c9                   		ret
   619                          
   620   000420 cdd504          f420:		call	newline
   621   000423 79                   		ld	a, c
   622   000424 fe47                 		cp	47h
   623   000426 2836                 		jr	z, f45e		; (+36h)
   624   000428 fe42                 		cp	42h
   625   00042a 2833                 		jr	z, f45f		; (+33h)
   626   00042c fe4d                 		cp	4dh
   627   00042e 20e9                 		jr	nz, f419		; (-17h)
   628   000430 cd93f4          f430:		call	0f493h
   629   000433 7e                   		ld	a, (hl)
   630   000434 cd98f4               		call	0f498h
   631   000437 cdb204               		call	getchar
   632   00043a fe0d                 		cp	0dh
   633   00043c 2818                 		jr	z, f456		; (+18h)
   634   00043e fe2d                 		cp	2dh
   635   000440 2816                 		jr	z, f458		; (+16h)
   636   000442 cd83f4               		call	0f483h
   637   000445 3f                   		ccf
   638   000446 d0                   		ret	nc
   639                          
   640   000447 07                   		rlca
   641   000448 07                   		rlca
   642   000449 07                   		rlca
   643   00044a 07                   		rlca
   644   00044b 4f                   		ld	c, a
   645   00044c cdb204               		call	getchar
   646   00044f cd83f4               		call	0f483h
   647   000452 3f                   		ccf
   648   000453 d0                   		ret	nc
   649                          
   650   000454 b1                   		or	c
   651   000455 77                   		ld	(hl), a
   652   000456 23              f456:		inc	hl
   653   000457 23                   		inc	hl
   654   000458 2b              f458:		dec	hl
   655   000459 cdd504               		call	newline
   656   00045c 18d2                 		jr	f430		; (-2eh)
   657   00045e e9              f45e:		jp	(hl)
   658   00045f dd217af4        f45f:		ld	ix, 0f47ah
   659   000463 cd22f0               		call	0f022h
   660   000466 dd7e08               		ld	a, (ix+08h)
   661   000469 b7                   		or	a
   662   00046a cc8000               		call	z, 0080h
   663   00046d f5                   		push	af
   664   00046e cdc9f4               		call	0f4c9h
   665   000471 2045                 		jr	nz, f4b8		; (+45h)
   666   000473 52                   		ld	d, d
   667   000474 52                   		ld	d, d
   668   000475 2000                 		jr	nz, f477		; (+00h)
   669   000477 f1              f477:		pop	af
   670   000478 1825                 		jr	f49f		; (+25h)
   671   00047a 010000               		ld	bc, 0000h
   672   00047d 018000               		ld	bc, 0080h
   673   000480 80                   		add	a, b
   674   000481 00                   		nop
   675   000482 00                   		nop
   676   000483 d630                 		sub	30h
   677   000485 d8                   		ret	c
   678                          
   679   000486 fe0a                 		cp	0ah
   680   000488 3f                   		ccf
   681   000489 d0                   		ret	nc
   682                          
   683   00048a d607                 		sub	07h
   684   00048c fe0a                 		cp	0ah
   685   00048e d8                   		ret	c
   686                          
   687   00048f fe10                 		cp	10h
   688   000491 3f                   		ccf
   689   000492 c9                   		ret
   690                          
   691   000493 7c                   		ld	a, h
   692   000494 cd9ff4               		call	0f49fh
   693   000497 7d                   		ld	a, l
   694   000498 cd9ff4               		call	0f49fh
   695   00049b 3e20                 		ld	a, 20h
   696   00049d 181f                 		jr	putchar		; (+1fh)
   697   00049f f5              f49f:		push	af
   698   0004a0 1f                   		rra
   699   0004a1 1f                   		rra
   700   0004a2 1f                   		rra
   701   0004a3 1f                   		rra
   702   0004a4 cda8f4               		call	0f4a8h
   703   0004a7 f1                   		pop	af
   704   0004a8 e60f                 		and	0fh
   705   0004aa c690                 		add	a, 90h
   706   0004ac 27                   		daa
   707   0004ad ce40                 		adc	a, 40h
   708   0004af 27                   		daa
   709   0004b0 180c                 		jr	putchar		; (+0ch)
   710                          
   711   0004b2 e5              getchar:     	push	hl
   712   0004b3 c5                   		push	bc
   713   0004b4 cd0900               		call	jmpCONIN			;CONIN in jumptable
   714   0004b7 c1                   		pop	bc
   715   0004b8 e1              f4b8:		pop	hl
   716   0004b9 cbbf                 		res	7, a
   717   0004bb fe20                 		cp	20h				;char < 20h = control char?
   718   0004bd d8                   		ret	c				;yes, return
   719                          
   720   0004be e5              putchar:	push	hl				;echo CONOUT
   721   0004bf c5                   		push	bc
   722   0004c0 f5                   		push	af
   723   0004c1 4f                   		ld	c, a
   724   0004c2 cd0c00               		call	jmpCONOUT
   725   0004c5 f1                   		pop	af
   726   0004c6 c1                   		pop	bc
   727   0004c7 e1                   		pop	hl
   728   0004c8 c9                   		ret
   729                          
   730   0004c9 e3              printstr:    	ex	(sp), hl			;exchange (load) hl with stackpointer
   731   0004ca 7e              printstr1:	ld	a, (hl)				;load char
   732   0004cb cdbe04               		call	putchar				;print it
   733   0004ce 7e                   		ld	a, (hl)				;load it again
   734   0004cf 23                   		inc	hl				;increment hl
   735   0004d0 b7                   		or	a				;char <> 0?
   736   0004d1 20f7                 		jr	nz, printstr1			;loop
   737   0004d3 e3                   		ex	(sp), hl			;write hl back to stack
   738   0004d4 c9                   		ret
   739                          
   740   0004d5 cdc904          newline:     	call	printstr
   741   0004d8 0d0a00          		db	"\r\n", 0
   742   0004db c9                   		ret
   743                          
   744   0004dc 79                   		ld	a, c
   745   0004dd d320                 		out	(20h), a
   746   0004df e3                   		ex	(sp), hl
   747   0004e0 e3                   		ex	(sp), hl
   748   0004e1 3e19                 		ld	a, 19h
   749   0004e3 d353                 		out	(53h), a
   750   0004e5 3d              f4e5:		dec	a
   751   0004e6 20fd                 		jr	nz, f4e5		; (-03h)
   752   0004e8 d353                 		out	(53h), a
   753   0004ea c9                   		ret
   754                          
   755   0004eb 2a47ff          f4eb:     	ld	hl, (0ff47h)
   756   0004ee db20                 		in	a, (20h)			;printer control
   757   0004f0 a5                   		and	l
   758   0004f1 ac                   		xor	h
   759   0004f2 c9                   		ret
   760                          
   761   0004f3 95                   		sub	l
   762   0004f4 00                   		nop
   763   0004f5 00                   		nop
   764   0004f6 00                   		nop
   765   0004f7 00                   		nop
   766   0004f8 00                   		nop
   767   0004f9 00                   		nop
   768   0004fa 00                   		nop
   769   0004fb 00                   		nop
   770   0004fc 00                   		nop
   771   0004fd 00                   		nop
   772   0004fe 00                   		nop
   773   0004ff 00                   		nop
   774                          
   775                          ;--------------------------------------------------
   776                          ; T/C 0 (here counter) interrupt for start-bit
   777                          ;--------------------------------------------------
   778   000500 f5              f500:		push	af
   779   000501 3e87                 		ld	a, 87h
   780   000503 d380                 		out	(80h), a			;set T/C 0 to 9600 Baud timer
   781   000505 3e1a                 		ld	a, 1ah
   782   000507 d380                 		out	(80h), a
   783   000509 3e17                 		ld	a, 17h				;set T/C 0 interrupt
   784   00050b 3210ff               		ld	(0ff10h), a
   785   00050e 3e7f                 		ld	a, 7fh				;count 127
   786   000510 321cf5          f510:		ld	(0f51ch), a
   787   000513 f1                   		pop	af
   788   000514 fb                   		ei
   789   000515 ed4d                 		reti
   790                          
   791   000517 f5              f517:    	push	af
   792   000518 db70                 		in	a, (70h)
   793   00051a 17                   		rla
   794   00051b 3e00            f51b:    	ld	a, 00h				;<- set by previous routine to 7F
   795   00051d 1f                   		rra
   796   00051e 38f0                 		jr	c, f510				;loop 7 times
   797   000520 3200ff          f520:     	ld	(0ff00h), a			;store result in ff00
   798   000523 3e2c                 		ld	a, 2ch				;timer 0 interrupt vector = 0ff2c
   799   000525 3210ff          		ld	(0ff10h), a
   800   000528 f1                   		pop	af
   801   000529 fb                   		ei
   802   00052a ed4d                 		reti
   803                          
   804   00052c f5              f52c:     	push	af
   805   00052d 3ec7                 		ld	a, 0c7h				;timer 0 counter
   806   00052f d380                 		out	(80h), a
   807   000531 3e01                 		ld	a, 01h
   808   000533 d380                 		out	(80h), a
   809   000535 3a21f5               		ld	a, (0f521h)
   810   000538 3c                   		inc	a
   811   000539 e60f                 		and	0fh
   812   00053b 3221f5               		ld	(0f521h), a			;increment buffer (16 bytes)
   813   00053e 3e00                 		ld	a, 00h				;reset T/C 0 interrupt
   814   000540 3210ff               		ld	(0ff10h), a
   815   000543 f1                   		pop	af
   816   000544 fb                   		ei
   817   000545 ed4d                 		reti
   818                          
   819   000547 f5                   		push	af
   820   000548 af                   		xor	a
   821   000549 d350                 		out	(50h), a
   822   00054b 3e54                 		ld	a, 54h
   823   00054d 3212ff               		ld	(0ff12h), a
   824   000550 f1                   		pop	af
   825   000551 fb                   		ei
   826   000552 ed4d                 		reti
   827                          
   828   000554 f5                   		push	af
   829   000555 3e00                 		ld	a, 00h
   830   000557 d350                 		out	(50h), a
   831   000559 1f                   		rra
   832   00055a 3268f5               		ld	(0f568h), a
   833   00055d 3e66                 		ld	a, 66h
   834   00055f 3212ff               		ld	(0ff12h), a
   835   000562 f1                   		pop	af
   836   000563 fb                   		ei
   837   000564 ed4d                 		reti
   838                          
   839   000566 f5                   		push	af
   840   000567 3e00                 		ld	a, 00h
   841   000569 d350                 		out	(50h), a
   842   00056b 1f                   		rra
   843   00056c 327af5               		ld	(0f57ah), a
   844   00056f 3e78                 		ld	a, 78h
   845   000571 3212ff               		ld	(0ff12h), a
   846   000574 f1                   		pop	af
   847   000575 fb                   		ei
   848   000576 ed4d                 		reti
   849                          
   850   000578 f5                   		push	af
   851   000579 3e00                 		ld	a, 00h
   852   00057b d350                 		out	(50h), a
   853   00057d 1f                   		rra
   854   00057e 328cf5               		ld	(0f58ch), a
   855   000581 3e8a                 		ld	a, 8ah
   856   000583 3212ff               		ld	(0ff12h), a
   857   000586 f1                   		pop	af
   858   000587 fb                   		ei
   859   000588 ed4d                 		reti
   860                          
   861   00058a f5                   		push	af
   862   00058b 3e00                 		ld	a, 00h
   863   00058d d350                 		out	(50h), a
   864   00058f 1f                   		rra
   865   000590 329ef5               		ld	(0f59eh), a
   866   000593 3e9c                 		ld	a, 9ch
   867   000595 3212ff               		ld	(0ff12h), a
   868   000598 f1                   		pop	af
   869   000599 fb                   		ei
   870   00059a ed4d                 		reti
   871                          
   872   00059c f5                   		push	af
   873   00059d 3e00                 		ld	a, 00h
   874   00059f d350                 		out	(50h), a
   875   0005a1 1f                   		rra
   876   0005a2 32b0f5               		ld	(0f5b0h), a
   877   0005a5 3eae                 		ld	a, 0aeh
   878   0005a7 3212ff               		ld	(0ff12h), a
   879   0005aa f1                   		pop	af
   880   0005ab fb                   		ei
   881   0005ac ed4d                 		reti
   882                          
   883   0005ae f5                   		push	af
   884   0005af 3e00                 		ld	a, 00h
   885   0005b1 d350                 		out	(50h), a
   886   0005b3 1f                   		rra
   887   0005b4 32c2f5               		ld	(0f5c2h), a
   888   0005b7 3ec0                 		ld	a, 0c0h
   889   0005b9 3212ff               		ld	(0ff12h), a
   890   0005bc f1                   		pop	af
   891   0005bd fb                   		ei
   892   0005be ed4d                 		reti
   893                          
   894   0005c0 f5                   		push	af
   895   0005c1 3e00                 		ld	a, 00h
   896   0005c3 d350                 		out	(50h), a
   897   0005c5 1f                   		rra
   898   0005c6 32d4f5               		ld	(0f5d4h), a
   899   0005c9 3ed2                 		ld	a, 0d2h
   900   0005cb 3212ff               		ld	(0ff12h), a
   901   0005ce f1                   		pop	af
   902   0005cf fb                   		ei
   903   0005d0 ed4d                 		reti
   904                          
   905   0005d2 f5                   		push	af
   906   0005d3 3e00                 		ld	a, 00h
   907   0005d5 d350                 		out	(50h), a
   908   0005d7 3ee0                 		ld	a, 0e0h
   909   0005d9 3212ff               		ld	(0ff12h), a
   910   0005dc f1                   		pop	af
   911   0005dd fb                   		ei
   912   0005de ed4d                 		reti
   913                          
   914   0005e0 f5                   		push	af
   915   0005e1 3e01                 		ld	a, 01h
   916   0005e3 d350                 		out	(50h), a
   917   0005e5 3eee                 		ld	a, 0eeh
   918   0005e7 3212ff               		ld	(0ff12h), a
   919   0005ea f1                   		pop	af
   920   0005eb fb                   		ei
   921   0005ec ed4d                 		reti
   922                          
   923   0005ee f5              f5ee: 		push	af			;disable timer 1 interrupt
   924   0005ef 3e01                 		ld	a, 01h
   925   0005f1 d381                 		out	(81h), a
   926   0005f3 3eff                 		ld	a, 0ffh
   927   0005f5 3212ff               		ld	(0ff12h), a
   928   0005f8 f1                   		pop	af
   929   0005f9 fb                   		ei
   930   0005fa ed4d                 		reti
   931                          ;--------------------------------------------------
   932                          ; SALLY Monitor
   933                          ;--------------------------------------------------
   934                          f5fc:
   935   0005fc f3              init9600:	di
   936   0005fd 21eef5               		ld	hl, 0f5eeh		;point Timer 1 interrupt
   937   000600 2212ff               		ld	(0ff12h), hl		;to 0f5eeh
   938   000603 3e07                 		ld	a, 07h			;Timer 1 reset, no int
   939   000605 d381                 		out	(81h), a		;load time constant
   940   000607 3a06f5               		ld	a, (0f506h)		;01ah = 9600 Baud
   941   00060a d381                 		out	(81h), a
   942   00060c 2100ff               		ld	hl, 0ff00h
   943   00060f 2221f5               		ld	(0f521h), hl
   944   000612 2233f6               		ld	(0f633h), hl
   945   000615 f3                   		di
   946   000616 3e01                 		ld	a, 01h
   947   000618 d357                 		out	(57h), a		;enable SIO-Trig
   948   00061a 067e            f61a:		ld	b, 7eh
   949   00061c db70            f61c:		in	a, (70h)		;read SIO
   950   00061e 17                   		rla				;D7 (RX) to carry
   951   00061f 30f9                 		jr	nc, f61a		;0? repeat
   952   000621 10f9                 		djnz	f61c			;high for 126 loops?
   953   000623 3ec7                 		ld	a, 0c7h			;T/C 0 interrupt on, counter mode, falling edge (start bit)
   954   000625 d380                 		out	(80h), a
   955   000627 3e01                 		ld	a, 01h			;T/C 0, count just 1
   956   000629 d380                 		out	(80h), a
   957   00062b 2100f5               		ld	hl, 0f500h		;set T/C 0 int to 0f500h
   958   00062e 2210ff               		ld	(0ff10h), hl
   959   000631 fb                   		ei
   960   000632 c9                   		ret
   961                          
   962   000633 00                   		nop
   963   000634 ff                   		rst	38h
   964   000635 2133f6               		ld	hl, 0f633h
   965   000638 3a21f5               		ld	a, (0f521h)
   966   00063b 96                   		sub	(hl)
   967   00063c c8                   		ret	z
   968                          
   969   00063d 3eff                 		ld	a, 0ffh
   970   00063f c9                   		ret
   971                          
   972   000640 cd35f6          f640:		call	0f635h
   973   000643 28fb                 		jr	z, f640		; (-05h)
   974   000645 2a33f6               		ld	hl, (0f633h)
   975   000648 7e                   		ld	a, (hl)
   976   000649 2c                   		inc	l
   977   00064a cba5                 		res	4, l
   978   00064c 2233f6               		ld	(0f633h), hl
   979   00064f c9                   		ret
   980                          
   981   000650 3a12ff          f650:		ld	a, (0ff12h)
   982   000653 feee                 		cp	0eeh
   983   000655 38f9                 		jr	c, f650		; (-07h)
   984   000657 79                   		ld	a, c
   985   000658 e67f                 		and	7fh
   986   00065a e25ff6               		jp	po, 0f65fh
   987   00065d f680                 		or	80h
   988   00065f 3256f5               		ld	(0f556h), a
   989   000662 3e47                 		ld	a, 47h
   990   000664 3212ff               		ld	(0ff12h), a
   991   000667 3e81                 		ld	a, 81h
   992   000669 d381                 		out	(81h), a
   993   00066b c9                   		ret
   994                          
   995   00066c e5                   		push	hl
   996   00066d d5                   		push	de
   997   00066e 2101c3               		ld	hl, 0c301h
   998   000671 73                   		ld	(hl), e
   999   000672 1600                 		ld	d, 00h
  1000   000674 cd84f6               		call	0f684h
  1001   000677 d1                   		pop	de
  1002   000678 e1                   		pop	hl
  1003   000679 1e00                 		ld	e, 00h
  1004   00067b cd84f6               		call	0f684h
  1005   00067e 2101c3               		ld	hl, 0c301h
  1006   000681 73                   		ld	(hl), e
  1007   000682 1600                 		ld	d, 00h
  1008   000684 f3                   		di
  1009   000685 0119f7               		ld	bc, 0f719h
  1010   000688 ed4312ff             		ld	(0ff12h), bc
  1011   00068c 0608                 		ld	b, 08h
  1012   00068e 3e87                 		ld	a, 87h
  1013   000690 d381                 		out	(81h), a
  1014   000692 3e0d                 		ld	a, 0dh
  1015   000694 d381                 		out	(81h), a
  1016   000696 fb                   		ei
  1017   000697 18fe            f697:		jr	f697		; (-02h)
  1018                          
  1019                          
  1020                          ;--------------------------------------------------
  1021                          ; SIO command frame interrupt
  1022                          ;--------------------------------------------------
  1023   000699 08              f699:     	ex	af, af'
  1024   00069a d9                   		exx
  1025   00069b 3eff                 		ld	a, 0ffh			;read pending
  1026   00069d 3255ff               		ld	(0ff55h), a
  1027   0006a0 d357                 		out	(57h), a		;switch to sio
  1028   0006a2 21fbc2               		ld	hl, 0c2fbh		;read 5 bytes command frame
  1029   0006a5 cdd906               		call	readSIO
  1030   0006a8 300a                 		jr	nc, f6b4		; (+0ah)
  1031   0006aa 2b                   		dec	hl
  1032   0006ab 7e                   		ld	a, (hl)
  1033   0006ac b9                   		cp	c			;checksum correct
  1034   0006ad 2005                 		jr	nz, f6b4
  1035   0006af 3e01                 		ld	a, 01h			;yes, frame received
  1036   0006b1 3255ff               		ld	(0ff55h), a
  1037   0006b4 08              f6b4:		ex	af, af'
  1038   0006b5 d9                   		exx
  1039   0006b6 fb                   		ei
  1040   0006b7 ed4d                 		reti
  1041                          
  1042   0006b9 f3                   		di
  1043   0006ba 2100c1               		ld	hl, 0c100h
  1044   0006bd cdd906               		call	readSIO
  1045   0006c0 fb                   		ei
  1046   0006c1 380d                 		jr	c, f6d0		; (+0dh)
  1047   0006c3 2b                   		dec	hl
  1048   0006c4 7e                   		ld	a, (hl)
  1049   0006c5 b9                   		cp	c
  1050   0006c6 2008                 		jr	nz, f6d0		; (+08h)
  1051   0006c8 1100c1               		ld	de, 0c100h
  1052   0006cb b7                   		or	a
  1053   0006cc ed52                 		sbc	hl, de
  1054   0006ce af                   		xor	a
  1055   0006cf c9                   		ret
  1056                          
  1057   0006d0 3e4e            f6d0:		ld	a, 4eh
  1058   0006d2 cd56fc               		call	0fc56h
  1059   0006d5 3eff                 		ld	a, 0ffh
  1060   0006d7 b7                   		or	a
  1061   0006d8 c9                   		ret
  1062                          
  1063   0006d9 11aa0a          readSIO:     	ld	de, 0aaah			;read atari ser 19200 Baud
  1064   0006dc 010000               		ld	bc, 0000h
  1065   0006df 1823                 		jr	getstartbit
  1066                          
  1067   0006e1 79              readSIO1:	ld	a, c                            ;4	compute checksum in c
  1068   0006e2 80                   		add	a, b                            ;4
  1069   0006e3 ce00                 		adc	a, 00h                          ;7
  1070   0006e5 4f                   		ld	c, a                            ;4
  1071   0006e6 e3                   		ex	(sp), hl                        ;19
  1072   0006e7 e3                   		ex	(sp), hl                        ;19
  1073   0006e8 e3                   		ex	(sp), hl                        ;19
  1074   0006e9 e3                   		ex	(sp), hl                        ;19
  1075   0006ea 0608                 		ld	b, 08h                          ;7	102
  1076                          
  1077   0006ec 3e0b            readSIO2:	ld	a, 0bh				;7
  1078   0006ee 3e0b                 		ld	a, 0bh				;7
  1079   0006f0 00                   		nop					;4
  1080   0006f1 3d              readSIO3:    	dec	a				;4
  1081   0006f2 c2f106               		jp	nz, readSIO3			;10
  1082   0006f5 db70                 		in	a, (70h)			;11
  1083   0006f7 17                   		rla					;4	bit7 to carry
  1084   0006f8 cb1a                 		rr	d				;8	carry lsb-wise in d
  1085   0006fa 10f0                 		djnz	readSIO2			;13	times
  1086                          
  1087   0006fc 42                   		ld	b, d				;save d in b
  1088   0006fd 72                   		ld	(hl), d				;also store in (hl)
  1089   0006fe 23                   		inc	hl				;increment hl
  1090   0006ff 7c                   		ld	a, h				;until hl = 0C300h
  1091   000700 fec3                 		cp	0c3h
  1092   000702 3f                   		ccf
  1093   000703 d8                   		ret	c				;carry set = 0C300h reached
  1094                          
  1095   000704 3e47            getstartbit:	ld	a, 47h				; CH0 noint+counter+pre16+falling autocnt+timeconst+reset+ctrl
  1096   000706 d380                 		out	(80h), a                        ;        	 4              	7
  1097   000708 af                   		xor	a
  1098   000709 d380                 		out	(80h), a                        ; counter init value 0
  1099   00070b 11a101               		ld	de, 01a1h
  1100   00070e db80            getstartbit1:	in	a, (80h)                        ; counter zero?
  1101   000710 b7                   		or	a
  1102   000711 20ce                 		jr	nz, readSIO1			; start-bit
  1103   000713 1b                   		dec	de
  1104   000714 7a                   		ld	a, d
  1105   000715 b3                   		or	e                               ; carry clear
  1106   000716 20f6                 		jr	nz, getstartbit1		; de not zero, try again
  1107   000718 c9                   		ret                                     ; return carry clear, zero
  1108                          
  1109   000719 af                   		xor	a
  1110   00071a d350                 		out	(50h), a
  1111   00071c fb                   		ei
  1112   00071d 7e                   		ld	a, (hl)
  1113   00071e 23                   		inc	hl
  1114   00071f aa                   		xor	d
  1115   000720 4f                   		ld	c, a
  1116   000721 83                   		add	a, e
  1117   000722 ce00                 		adc	a, 00h
  1118   000724 5f                   		ld	e, a
  1119   000725 3e2c                 		ld	a, 2ch
  1120   000727 3212ff               		ld	(0ff12h), a
  1121   00072a ed4d                 		reti
  1122                          
  1123   00072c 79                   		ld	a, c
  1124   00072d d350                 		out	(50h), a
  1125   00072f fb                   		ei
  1126   000730 cb19                 		rr	c
  1127   000732 1005                 		djnz	f739		; (+05h)
  1128   000734 3e3b                 		ld	a, 3bh
  1129   000736 3212ff               		ld	(0ff12h), a
  1130   000739 ed4d            f739:		reti
  1131                          
  1132   00073b 3e01                 		ld	a, 01h
  1133   00073d d350                 		out	(50h), a
  1134   00073f fb                   		ei
  1135   000740 7c                   		ld	a, h
  1136   000741 fec3                 		cp	0c3h
  1137   000743 3009                 		jr	nc, f74e		; (+09h)
  1138   000745 0608                 		ld	b, 08h
  1139   000747 3e19                 		ld	a, 19h
  1140   000749 3212ff               		ld	(0ff12h), a
  1141   00074c ed4d                 		reti
  1142                          
  1143   00074e 3e55            f74e:		ld	a, 55h
  1144   000750 3212ff               		ld	(0ff12h), a
  1145   000753 ed4d                 		reti
  1146                          
  1147   000755 3e01                 		ld	a, 01h
  1148   000757 d381                 		out	(81h), a
  1149   000759 fb                   		ei
  1150   00075a 3eff                 		ld	a, 0ffh
  1151   00075c 3212ff               		ld	(0ff12h), a
  1152   00075f e1                   		pop	hl
  1153   000760 ed4d                 		reti
  1154                          
  1155                          ;--------------------------------------------------
  1156                          ; Main entry after startup from ROM
  1157                          ;--------------------------------------------------
  1158   000762 3e01            main:     	ld	a, 01h           		;executed after startup
  1159   000764 d352                 		out	(52h), a         		;turn off ROM
  1160                          
  1161   000766 21fec2          read2bytes:	ld	hl, 0c2feh
  1162   000769 f3                   		di
  1163   00076a cdd906               		call	readSIO          		;read 2 bytes from SIO (until hl = c300)
  1164   00076d fb                   		ei
  1165   00076e 30f6                 		jr	nc, read2bytes			;nothing read within a timeframe,  read again
  1166   000770 2afec2               		ld	hl, (0c2feh)     		;load hl with bytes read
  1167   000773 11e680               		ld	de, 80e6h
  1168   000776 b7                   		or	a               		;clear carry
  1169   000777 ed52                 		sbc	hl, de
  1170   000779 cade03               		jp	z, sallymon        		;080e6h read? -> Sally Monitor
  1171                          
  1172   00077c 3e03                 		ld	a, 03h           		;no
  1173   00077e 3233ff               		ld	(0ff33h), a      		;store 03h in ff33h (03h = inc bc)
  1174   000781 3e38                 		ld	a, 38h           		;store 38h in f188h (038h = jr c,  d)
  1175   000783 3288f1               		ld	(0f188h), a
  1176   000786 db50                 		in	a, (50h)         		;test bit 3 of RS232 (jumper,  should be 1)
  1177   000788 cb5f                 		bit	3, a
  1178   00078a 2005                 		jr	nz, f791			;
  1179   00078c 3eff                 		ld	a, 0ffh          		;if zero,  store ffh (= rst 38h)
  1180   00078e 322308               		ld	(f823), a      			;to f823h (switch printer off?)
  1181   000791 21e107          f791:		ld	hl, return
  1182   000794 2219f0               		ld	(0f019h), hl			;hl points to RET
  1183   000797 ed5b1930             		ld	de, (3019h)
  1184   00079b b7                   		or	a
  1185   00079c ed52                 		sbc	hl, de
  1186   00079e 280c                 		jr	z, sioloop
  1187   0007a0 210000               		ld	hl, 0000h
  1188   0007a3 224bff               		ld	(0ff4bh), hl
  1189   0007a6 21ffbf               		ld	hl, 0bfffh
  1190   0007a9 224dff               		ld	(0ff4dh), hl
  1191                          
  1192                          ;--------------------------------------------------
  1193                          ; Looks like the main Atari SIO handler loop
  1194                          ;--------------------------------------------------
  1195   0007ac cdd1f8          sioloop:	call	0f8d1h				;output to printer? (check buffer)
  1196   0007af 2a3aff               		ld	hl, (0ff3ah)    		;f7be
  1197   0007b2 cdbd07               		call	jumphl         			;call (ff3a)
  1198   0007b5 2a3cff               		ld	hl, (0ff3ch)    		;f7e1 (nomally return)
  1199   0007b8 cdbd07               		call	jumphl         			;call (ff3c)
  1200   0007bb 18ef                 		jr	sioloop
  1201                          
  1202   0007bd e9              jumphl:     	jp	(hl)
  1203                          
  1204   0007be db70            f7be:     	in	a, (70h)        		;in SIO
  1205   0007c0 e68a                 		and	8ah				;1---1-1-	;Stop-bit, no command (high) = idle
  1206   0007c2 fe8a                 		cp	8ah
  1207   0007c4 c0                   		ret	nz				;is not idle? return
  1208                          
  1209                          ;--------------------------------------------------
  1210                          ; program CTC to detect CMD
  1211                          ;--------------------------------------------------
  1212   0007c5 f3                   		di
  1213   0007c6 af                   		xor	a
  1214   0007c7 3255ff               		ld	(0ff55h), a			;select 0=CMD or 1=SIO
  1215   0007ca d357                 		out	(57h), a
  1216   0007cc 3ed7                 		ld	a, 0d7h				;CH0 int+counter+pre16+rising autocnt+timeconst+reset+ctrl
  1217                          							;		D 				7
  1218   0007ce d380                 		out	(80h), a                        ;program CTC
  1219   0007d0 3e01                 		ld	a, 01h
  1220   0007d2 d380                 		out	(80h), a                        ;counter
  1221   0007d4 2199f6               		ld	hl, 0f699h
  1222   0007d7 2210ff               		ld	(0ff10h), hl
  1223   0007da fb                   		ei
  1224   0007db 21e207               		ld	hl, cmdframe
  1225   0007de 223aff               		ld	(0ff3ah), hl
  1226   0007e1 c9               return:    	ret
  1227                          
  1228                          ;--------------------------------------------------
  1229                          ; handle command frame
  1230                          ;--------------------------------------------------
  1231   0007e2 3a55ff          cmdframe:     	ld	a, (0ff55h)
  1232   0007e5 b7                   		or	a
  1233   0007e6 c8                   		ret	z               		;no frame received yet
  1234                          
  1235   0007e7 fe01                 		cp	01h             		;frame received?
  1236   0007e9 2808                 		jr	z, cmdframe1			;handle it
  1237   0007eb f3                   		di
  1238   0007ec 3e03                 		ld	a, 03h           		;noint timer pre16 falling  reset vector
  1239   0007ee d380                 		out	(80h), a         		;CTC Channel 0
  1240   0007f0 fb                   		ei
  1241   0007f1 1816                 		jr	cmdframe2
  1242                          
  1243   0007f3 3afbc2          cmdframe1:	ld	a, (0c2fbh)      		;load device ID
  1244   0007f6 2a38ff               		ld	hl, (0ff38h)			;load addr device table
  1245   0007f9 cd1008               		call	gettable
  1246   0007fc 200b                 		jr	nz, cmdframe2			;not found, return
  1247   0007fe 3afcc2               		ld	a, (0c2fch)			;load command
  1248   000801 cd1008               		call	gettable
  1249   000804 2003                 		jr	nz, cmdframe2			;not found;
  1250   000806 cdbd07               		call	jumphl				;call (hl)
  1251                          
  1252   000809 21bef7          cmdframe2:	ld	hl, 0f7beh
  1253   00080c 223aff               		ld	(0ff3ah), hl
  1254   00080f c9                   		ret
  1255                          
  1256                          
  1257   000810 4e              gettable:    	ld	c, (hl)
  1258   000811 23                   		inc	hl
  1259   000812 46                   		ld	b, (hl)
  1260   000813 23                   		inc	hl
  1261   000814 edb1                 		cpir
  1262   000816 c0                   		ret	nz
  1263                          
  1264   000817 f5                   		push	af
  1265   000818 09                   		add	hl, bc
  1266   000819 09                   		add	hl, bc
  1267   00081a 09                   		add	hl, bc
  1268   00081b 7e                   		ld	a, (hl)
  1269   00081c 23                   		inc	hl
  1270   00081d 66                   		ld	h, (hl)
  1271   00081e 6f                   		ld	l, a
  1272   00081f f1                   		pop	af
  1273   000820 c9                   		ret
  1274                          
  1275   000821 0600            devicetab:	dw	06				;number of devices
  1276   000823 40              f823:		db	40h				;printer
  1277   000824 31323334        		db	31h, 32h, 33h, 34h		;disk 1-4
  1278   000828 5a              		db	5ah				;RS232?
  1279                          
  1280   000829 54f8            		dw	0f854h				;RS232
  1281   00082b 3df8            		dw	0f83dh				;Disk 4
  1282   00082d 3df8            		dw	0f83dh				;Disk 3
  1283   00082f 3df8            		dw	0f83dh				;Disk 2
  1284   000831 3df8            		dw	0f83dh				;Disk 1
  1285   000833 35f8            		dw	0f835h				;printer
  1286                          
  1287   000835 0200            		dw	2				;printer commands
  1288   000837 53              		db	53h				;status
  1289   000838 57              		db	57h				;write
  1290   000839 78f8            		dw	0f878h
  1291   00083b 62f8            		dw	0f862h
  1292                          
  1293   00083d 0700            		dw	7				;disk commands
  1294   00083f 52              		db	52h				;read		'R'
  1295   000840 53              		db	53h				;status		'S'
  1296   000841 57              		db	57h				;write		'W'
  1297   000842 50              		db	50h				;putchar	'P'
  1298   000843 4e              		db	4eh				;percom read	'N'
  1299   000844 4f              		db	4fh				;perfom write	'O'
  1300   000845 21              		db	21h				;format		'!'
  1301   000846 38fb            		dw	0fb38h
  1302   000848 05fc            		dw	0fc05h
  1303   00084a e7fb            		dw	0fbe7h
  1304   00084c 05f9            		dw	0f905h
  1305   00084e 08f9            		dw	0f908h
  1306   000850 dbfa            		dw	0fadbh
  1307   000852 8cf9            		dw	0f98ch
  1308                          
  1309   000854 0400            		dw	4				;printer commands
  1310   000856 52              		db	52h				;read
  1311   000857 57              		db      57h				;write
  1312   000858 53              		db      53h				;status
  1313   000859 47              		db	47h				;?
  1314   00085a b4fc            		dw	0fcb4h
  1315   00085c a6fc            		dw	0fca6h
  1316   00085e 7bfc            		dw	0fc7bh
  1317   000860 5ffc            		dw	0fc5fh
  1318                          
  1319   000862 cd4afc               		call	0fc4ah
  1320   000865 2143ff               		ld	hl, 0ff43h
  1321   000868 11fcc2               		ld	de, 0c2fch
  1322   00086b d5                   		push	de
  1323   00086c 010400               		ld	bc, 0004h
  1324   00086f edb0                 		ldir
  1325   000871 e1                   		pop	hl
  1326   000872 114300               		ld	de, 0043h
  1327   000875 c36cf6               		jp	0f66ch
  1328   000878 cd4afc               		call	0fc4ah
  1329   00087b cdb9f6               		call	0f6b9h
  1330   00087e c0                   		ret	nz
  1331                          
  1332   00087f 112800               		ld	de, 0028h
  1333   000882 b7                   		or	a
  1334   000883 ed52                 		sbc	hl, de
  1335   000885 c0                   		ret	nz
  1336                          
  1337   000886 cd4afc               		call	0fc4ah
  1338   000889 2100c1               		ld	hl, 0c100h
  1339   00088c 0628                 		ld	b, 28h
  1340   00088e 7e              f88e:		ld	a, (hl)
  1341   00088f fe9b                 		cp	9bh
  1342   000891 2005                 		jr	nz, f898		; (+05h)
  1343   000893 213eff               		ld	hl, 0ff3eh
  1344   000896 46                   		ld	b, (hl)
  1345   000897 23                   		inc	hl
  1346   000898 e5              f898:		push	hl
  1347   000899 2a4fff               		ld	hl, (0ff4fh)
  1348   00089c ed5b4dff             		ld	de, (0ff4dh)
  1349   0008a0 b7                   		or	a
  1350   0008a1 ed52                 		sbc	hl, de
  1351   0008a3 e1                   		pop	hl
  1352   0008a4 380e                 		jr	c, f8b4		; (+0eh)
  1353   0008a6 e5                   		push	hl
  1354   0008a7 c5                   		push	bc
  1355   0008a8 cdd1f8               		call	0f8d1h
  1356   0008ab c1                   		pop	bc
  1357   0008ac e1                   		pop	hl
  1358   0008ad db70                 		in	a, (70h)
  1359   0008af e602                 		and	02h
  1360   0008b1 20e5                 		jr	nz, f898		; (-1bh)
  1361   0008b3 c9                   		ret
  1362                          
  1363   0008b4 7e              f8b4:		ld	a, (hl)
  1364   0008b5 23                   		inc	hl
  1365   0008b6 e5                   		push	hl
  1366   0008b7 c5                   		push	bc
  1367   0008b8 2a51ff               		ld	hl, (0ff51h)
  1368   0008bb cdf1f8               		call	0f8f1h
  1369   0008be ed5351ff             		ld	(0ff51h), de
  1370   0008c2 77                   		ld	(hl), a
  1371   0008c3 2a4fff               		ld	hl, (0ff4fh)
  1372   0008c6 23                   		inc	hl
  1373   0008c7 224fff               		ld	(0ff4fh), hl
  1374   0008ca c1                   		pop	bc
  1375   0008cb e1                   		pop	hl
  1376   0008cc 10c0                 		djnz	f88e		; (-40h)
  1377   0008ce c354fc               		jp	0fc54h
  1378                          
  1379   0008d1 2a4fff          f8d1:     	ld	hl, (0ff4fh)			;is pointer in ff4f zero?
  1380   0008d4 7c                   		ld	a, h
  1381   0008d5 b5                   		or	l
  1382   0008d6 c8                   		ret	z				;normally yes, return
  1383                          
  1384   0008d7 cd15f0               		call	0f015h
  1385   0008da c0                   		ret	nz
  1386                          
  1387   0008db 2a53ff               		ld	hl, (0ff53h)
  1388   0008de cdf1f8               		call	0f8f1h
  1389   0008e1 ed5353ff             		ld	(0ff53h), de
  1390   0008e5 4e                   		ld	c, (hl)
  1391   0008e6 cd12f0               		call	0f012h
  1392   0008e9 2a4fff               		ld	hl, (0ff4fh)
  1393   0008ec 2b                   		dec	hl
  1394   0008ed 224fff               		ld	(0ff4fh), hl
  1395   0008f0 c9                   		ret
  1396                          
  1397   0008f1 eb                   		ex	de, hl
  1398   0008f2 2a4bff               		ld	hl, (0ff4bh)
  1399   0008f5 19                   		add	hl, de
  1400   0008f6 e5                   		push	hl
  1401   0008f7 13                   		inc	de
  1402   0008f8 2a4dff               		ld	hl, (0ff4dh)
  1403   0008fb b7                   		or	a
  1404   0008fc ed52                 		sbc	hl, de
  1405   0008fe 3003                 		jr	nc, f903		; (+03h)
  1406   000900 110000               		ld	de, 0000h
  1407   000903 e1              f903:		pop	hl
  1408   000904 c9                   		ret
  1409                          
  1410   000905 af                   		xor	a
  1411   000906 1802                 		jr	f90a		; (+02h)
  1412   000908 3e01                 		ld	a, 01h
  1413   00090a 32b5ff          f90a:		ld	(0ffb5h), a
  1414   00090d cd28fc               		call	0fc28h
  1415   000910 d8                   		ret	c
  1416                          
  1417   000911 cd4afc               		call	0fc4ah
  1418   000914 cdb9f6               		call	0f6b9h
  1419   000917 c0                   		ret	nz
  1420                          
  1421   000918 22a9ff               		ld	(0ffa9h), hl
  1422   00091b 118000               		ld	de, 0080h
  1423   00091e b7                   		or	a
  1424   00091f ed52                 		sbc	hl, de
  1425   000921 2804                 		jr	z, f927		; (+04h)
  1426   000923 b7                   		or	a
  1427   000924 ed52                 		sbc	hl, de
  1428   000926 c0                   		ret	nz
  1429                          
  1430   000927 cd4afc          f927:		call	0fc4ah
  1431   00092a cd10fa               		call	0fa10h
  1432   00092d 204e                 		jr	nz, f97d		; (+4eh)
  1433   00092f 2100c1               		ld	hl, 0c100h
  1434   000932 229cff               		ld	(0ff9ch), hl
  1435   000935 3aa9ff               		ld	a, (0ffa9h)
  1436   000938 47                   		ld	b, a
  1437   000939 7e              f939:		ld	a, (hl)
  1438   00093a 2f                   		cpl
  1439   00093b 77                   		ld	(hl), a
  1440   00093c 23                   		inc	hl
  1441   00093d 10fa                 		djnz	f939		; (-06h)
  1442   00093f 3e02                 		ld	a, 02h
  1443   000941 3298ff               		ld	(0ff98h), a
  1444   000944 dd2198ff             		ld	ix, 0ff98h
  1445   000948 cd0ff0               		call	0f00fh
  1446   00094b 3aa0ff               		ld	a, (0ffa0h)
  1447   00094e b7                   		or	a
  1448   00094f 202c                 		jr	nz, f97d		; (+2ch)
  1449   000951 3ab5ff               		ld	a, (0ffb5h)
  1450   000954 b7                   		or	a
  1451   000955 2826                 		jr	z, f97d		; (+26h)
  1452   000957 3e01                 		ld	a, 01h
  1453   000959 3298ff               		ld	(0ff98h), a
  1454   00095c 2100c3               		ld	hl, 0c300h
  1455   00095f 229cff               		ld	(0ff9ch), hl
  1456   000962 cd0ff0               		call	0f00fh
  1457   000965 3aa0ff               		ld	a, (0ffa0h)
  1458   000968 b7                   		or	a
  1459   000969 2012                 		jr	nz, f97d		; (+12h)
  1460   00096b 2100c1               		ld	hl, 0c100h
  1461   00096e 1100c3               		ld	de, 0c300h
  1462   000971 3a9eff               		ld	a, (0ff9eh)
  1463   000974 47                   		ld	b, a
  1464   000975 1a              f975:		ld	a, (de)
  1465   000976 ae                   		xor	(hl)
  1466   000977 200b                 		jr	nz, f984		; (+0bh)
  1467   000979 23                   		inc	hl
  1468   00097a 13                   		inc	de
  1469   00097b 10f8                 		djnz	f975		; (-08h)
  1470   00097d cde3f9          f97d:		call	0f9e3h
  1471   000980 7b                   		ld	a, e
  1472   000981 c356fc               		jp	0fc56h
  1473   000984 af              f984:		xor	a
  1474   000985 cd06fa               		call	0fa06h
  1475   000988 7b                   		ld	a, e
  1476   000989 c356fc               		jp	0fc56h
  1477   00098c cd28fc               		call	0fc28h
  1478   00098f d8                   		ret	c
  1479                          
  1480   000990 cd4afc               		call	0fc4ah
  1481   000993 cd10fa               		call	0fa10h
  1482   000996 f5                   		push	af
  1483   000997 280f                 		jr	z, f9a8		; (+0fh)
  1484   000999 fd5606               		ld	d, (iy+06h)
  1485   00099c fd5e07               		ld	e, (iy+07h)
  1486   00099f 7a                   		ld	a, d
  1487   0009a0 b3                   		or	e
  1488   0009a1 2009                 		jr	nz, f9ac		; (+09h)
  1489   0009a3 118000               		ld	de, 0080h
  1490   0009a6 1804                 		jr	f9ac		; (+04h)
  1491   0009a8 ed5b9eff        f9a8:		ld	de, (0ff9eh)
  1492   0009ac 2afdc2          f9ac:		ld	hl, (0c2fdh)
  1493   0009af 010400               		ld	bc, 0004h
  1494   0009b2 b7                   		or	a
  1495   0009b3 ed42                 		sbc	hl, bc
  1496   0009b5 3003                 		jr	nc, f9ba		; (+03h)
  1497   0009b7 118000               		ld	de, 0080h
  1498   0009ba ed53a9ff        f9ba:		ld	(0ffa9h), de
  1499   0009be 2100c3               		ld	hl, 0c300h
  1500   0009c1 b7                   		or	a
  1501   0009c2 ed52                 		sbc	hl, de
  1502   0009c4 f1                   		pop	af
  1503   0009c5 2014                 		jr	nz, f9db		; (+14h)
  1504   0009c7 229cff               		ld	(0ff9ch), hl
  1505   0009ca 3e01                 		ld	a, 01h
  1506   0009cc 3298ff               		ld	(0ff98h), a
  1507   0009cf dd2198ff             		ld	ix, 0ff98h
  1508   0009d3 e5                   		push	hl
  1509   0009d4 cd0ff0               		call	0f00fh
  1510   0009d7 e1                   		pop	hl
  1511   0009d8 3aa0ff               		ld	a, (0ffa0h)
  1512   0009db cde3f9          f9db:		call	0f9e3h
  1513   0009de 16ff                 		ld	d, 0ffh
  1514   0009e0 c36cf6               		jp	0f66ch
  1515   0009e3 b7                   		or	a
  1516   0009e4 200a                 		jr	nz, f9f0		; (+0ah)
  1517   0009e6 fd770d               		ld	(iy+0dh), a
  1518   0009e9 1e43                 		ld	e, 43h
  1519   0009eb fdcb0c96             		res	2, (iy+0ch)
  1520   0009ef c9                   		ret
  1521                          
  1522   0009f0 cb77            f9f0:		bit	6, a
  1523   0009f2 2802                 		jr	z, f9f6		; (+02h)
  1524   0009f4 e69f                 		and	9fh
  1525   0009f6 cb6f            f9f6:		bit	5, a
  1526   0009f8 2802                 		jr	z, f9fc		; (+02h)
  1527   0009fa f660                 		or	60h
  1528   0009fc 4f              f9fc:		ld	c, a
  1529   0009fd e681                 		and	81h
  1530   0009ff 79                   		ld	a, c
  1531   000a00 2804                 		jr	z, fa06		; (+04h)
  1532   000a02 e67e                 		and	7eh
  1533   000a04 f610                 		or	10h
  1534   000a06 fd770d          fa06:		ld	(iy+0dh), a
  1535   000a09 1e45                 		ld	e, 45h
  1536   000a0b fdcb0cd6             		set	2, (iy+0ch)
  1537   000a0f c9                   		ret
  1538                          
  1539   000a10 3a2eff               		ld	a, (0ff2eh)
  1540   000a13 b7                   		or	a
  1541   000a14 2811                 		jr	z, fa27		; (+11h)
  1542   000a16 af                   		xor	a
  1543   000a17 322eff               		ld	(0ff2eh), a
  1544   000a1a 2164ff               		ld	hl, 0ff64h
  1545   000a1d 111000               		ld	de, 0010h
  1546   000a20 0604                 		ld	b, 04h
  1547   000a22 cb86            fa22:		res	0, (hl)
  1548   000a24 19                   		add	hl, de
  1549   000a25 10fb                 		djnz	fa22		; (-05h)
  1550   000a27 fdcb0e46        fa27:		bit	0, (iy+0eh)
  1551   000a2b 206d                 		jr	nz, fa9a		; (+6dh)
  1552   000a2d 3e03                 		ld	a, 03h
  1553   000a2f 3298ff               		ld	(0ff98h), a
  1554   000a32 3a99ff               		ld	a, (0ff99h)
  1555   000a35 2120ff               		ld	hl, 0ff20h
  1556   000a38 85                   		add	a, l
  1557   000a39 6f                   		ld	l, a
  1558   000a3a 7e                   		ld	a, (hl)
  1559   000a3b fe50                 		cp	50h
  1560   000a3d 3801                 		jr	c, fa40		; (+01h)
  1561   000a3f af                   		xor	a
  1562   000a40 329aff          fa40:		ld	(0ff9ah), a
  1563   000a43 21abff               		ld	hl, 0ffabh
  1564   000a46 229cff               		ld	(0ff9ch), hl
  1565   000a49 dd2198ff             		ld	ix, 0ff98h
  1566   000a4d cd0ff0               		call	0f00fh
  1567   000a50 3aa0ff               		ld	a, (0ffa0h)
  1568   000a53 b7                   		or	a
  1569   000a54 c0                   		ret	nz
  1570                          
  1571   000a55 3aaeff               		ld	a, (0ffaeh)
  1572   000a58 cdcdfa               		call	0facdh
  1573   000a5b fd7006               		ld	(iy+06h), b
  1574   000a5e fd7107               		ld	(iy+07h), c
  1575   000a61 3a9eff               		ld	a, (0ff9eh)
  1576   000a64 07                   		rlca
  1577   000a65 07                   		rlca
  1578   000a66 07                   		rlca
  1579   000a67 2f                   		cpl
  1580   000a68 e606                 		and	06h
  1581   000a6a fd7705               		ld	(iy+05h), a
  1582   000a6d cb4f                 		bit	1, a
  1583   000a6f 2807                 		jr	z, fa78		; (+07h)
  1584   000a71 3e4d                 		ld	a, 4dh
  1585   000a73 211a00               		ld	hl, 001ah
  1586   000a76 1805                 		jr	fa7d		; (+05h)
  1587   000a78 3e28            fa78:		ld	a, 28h
  1588   000a7a 211200               		ld	hl, 0012h
  1589   000a7d fdbe00          fa7d:		cp	(iy+00h)
  1590   000a80 3803                 		jr	c, fa85		; (+03h)
  1591   000a82 fd7700               		ld	(iy+00h), a
  1592   000a85 fd7402          fa85:		ld	(iy+02h), h
  1593   000a88 fd7503               		ld	(iy+03h), l
  1594   000a8b fdcb0ec6             		set	0, (iy+0eh)
  1595   000a8f 2a96ff               		ld	hl, (0ff96h)
  1596   000a92 7c                   		ld	a, h
  1597   000a93 b5                   		or	l
  1598   000a94 2004                 		jr	nz, fa9a		; (+04h)
  1599   000a96 fd2296ff             		ld	(0ff96h), iy
  1600   000a9a 2afdc2          fa9a:		ld	hl, (0c2fdh)
  1601   000a9d 2b                   		dec	hl
  1602   000a9e 1600                 		ld	d, 00h
  1603   000aa0 fd5e03               		ld	e, (iy+03h)
  1604   000aa3 3eff                 		ld	a, 0ffh
  1605   000aa5 3c              faa5:		inc	a
  1606   000aa6 b7                   		or	a
  1607   000aa7 ed52                 		sbc	hl, de
  1608   000aa9 30fa                 		jr	nc, faa5		; (-06h)
  1609   000aab 19                   		add	hl, de
  1610   000aac 23                   		inc	hl
  1611   000aad 4d                   		ld	c, l
  1612   000aae 219bff               		ld	hl, 0ff9bh
  1613   000ab1 71                   		ld	(hl), c
  1614   000ab2 fdbe00               		cp	(iy+00h)
  1615   000ab5 3808                 		jr	c, fabf		; (+08h)
  1616   000ab7 fd9600               		sub	(iy+00h)
  1617   000aba 2199ff               		ld	hl, 0ff99h
  1618   000abd cbfe                 		set	7, (hl)
  1619   000abf 329aff          fabf:		ld	(0ff9ah), a
  1620   000ac2 fd6606               		ld	h, (iy+06h)
  1621   000ac5 fd6e07               		ld	l, (iy+07h)
  1622   000ac8 229eff               		ld	(0ff9eh), hl
  1623   000acb af                   		xor	a
  1624   000acc c9                   		ret
  1625                          
  1626   000acd 018000               		ld	bc, 0080h
  1627   000ad0 e603                 		and	03h
  1628   000ad2 c8                   		ret	z
  1629                          
  1630   000ad3 cb21            fad3:		sla	c
  1631   000ad5 cb10                 		rl	b
  1632   000ad7 3d                   		dec	a
  1633   000ad8 20f9                 		jr	nz, fad3		; (-07h)
  1634   000ada c9                   		ret
  1635                          
  1636   000adb cd28fc               		call	0fc28h
  1637   000ade d8                   		ret	c
  1638                          
  1639   000adf cd4afc               		call	0fc4ah
  1640   000ae2 cdd3fb               		call	0fbd3h
  1641   000ae5 3ac9ff               		ld	a, (0ffc9h)
  1642   000ae8 f5                   		push	af
  1643   000ae9 3e00                 		ld	a, 00h
  1644   000aeb 3298ff               		ld	(0ff98h), a
  1645   000aee dd2198ff             		ld	ix, 0ff98h
  1646   000af2 cd0ff0               		call	0f00fh
  1647   000af5 fd4e0c               		ld	c, (iy+0ch)
  1648   000af8 fd360c00             		ld	(iy+0ch), 00h
  1649   000afc f1                   		pop	af
  1650   000afd b7                   		or	a
  1651   000afe 2804                 		jr	z, fb04		; (+04h)
  1652   000b00 cbe1                 		set	4, c
  1653   000b02 1802                 		jr	fb06		; (+02h)
  1654   000b04 cba1            fb04:		res	4, c
  1655   000b06 fdcb0556        fb06:		bit	2, (iy+05h)
  1656   000b0a 2804                 		jr	z, fb10		; (+04h)
  1657   000b0c cbe9                 		set	5, c
  1658   000b0e 1802                 		jr	fb12		; (+02h)
  1659   000b10 cba9            fb10:		res	5, c
  1660   000b12 ddcb0876        fb12:		bit	6, (ix+08h)
  1661   000b16 2804                 		jr	z, fb1c		; (+04h)
  1662   000b18 cbd9                 		set	3, c
  1663   000b1a 1802                 		jr	fb1e		; (+02h)
  1664   000b1c cb99            fb1c:		res	3, c
  1665   000b1e 21fcc2          fb1e:		ld	hl, 0c2fch
  1666   000b21 e5                   		push	hl
  1667   000b22 71                   		ld	(hl), c
  1668   000b23 23                   		inc	hl
  1669   000b24 fd7e0d               		ld	a, (iy+0dh)
  1670   000b27 2f                   		cpl
  1671   000b28 77                   		ld	(hl), a
  1672   000b29 23                   		inc	hl
  1673   000b2a 36e0                 		ld	(hl), 0e0h
  1674   000b2c 23                   		inc	hl
  1675   000b2d 3a2dff               		ld	a, (0ff2dh)
  1676   000b30 77                   		ld	(hl), a
  1677   000b31 e1                   		pop	hl
  1678   000b32 114300               		ld	de, 0043h
  1679   000b35 c36cf6               		jp	0f66ch
  1680   000b38 cd28fc               		call	0fc28h
  1681   000b3b d8                   		ret	c
  1682                          
  1683   000b3c 2a4fff               		ld	hl, (0ff4fh)
  1684   000b3f 7c                   		ld	a, h
  1685   000b40 b5                   		or	l
  1686   000b41 c0                   		ret	nz
  1687                          
  1688   000b42 cdd3fb               		call	0fbd3h
  1689   000b45 c8                   		ret	z
  1690                          
  1691   000b46 cd4afc               		call	0fc4ah
  1692   000b49 3e00                 		ld	a, 00h
  1693   000b4b 3298ff               		ld	(0ff98h), a
  1694   000b4e dd2198ff             		ld	ix, 0ff98h
  1695   000b52 cd0ff0               		call	0f00fh
  1696   000b55 cdcbf3               		call	0f3cbh
  1697   000b58 3a2fff               		ld	a, (0ff2fh)
  1698   000b5b fdcb0556             		bit	2, (iy+05h)
  1699   000b5f 2807                 		jr	z, fb68		; (+07h)
  1700   000b61 cbbf                 		res	7, a
  1701   000b63 2100c2               		ld	hl, 0c200h
  1702   000b66 1805                 		jr	fb6d		; (+05h)
  1703   000b68 cbff            fb68:		set	7, a
  1704   000b6a 2180c2               		ld	hl, 0c280h
  1705   000b6d 322fff          fb6d:		ld	(0ff2fh), a
  1706   000b70 d330                 		out	(30h), a
  1707   000b72 e5                   		push	hl
  1708   000b73 22c1ff               		ld	(0ffc1h), hl
  1709   000b76 210100               		ld	hl, 0001h
  1710   000b79 22bfff               		ld	(0ffbfh), hl
  1711   000b7c 2a49ff               		ld	hl, (0ff49h)
  1712   000b7f 11b6ff               		ld	de, 0ffb6h
  1713   000b82 010700               		ld	bc, 0007h
  1714   000b85 07                   		rlca
  1715   000b86 07                   		rlca
  1716   000b87 e603                 		and	03h
  1717   000b89 2804                 		jr	z, fb8f		; (+04h)
  1718   000b8b 09              fb8b:		add	hl, bc
  1719   000b8c 3d                   		dec	a
  1720   000b8d 20fc                 		jr	nz, fb8b		; (-04h)
  1721   000b8f edb0            fb8f:		ldir
  1722   000b91 3aa0ff               		ld	a, (0ffa0h)
  1723   000b94 e6c0                 		and	0c0h
  1724   000b96 2013                 		jr	nz, fbab		; (+13h)
  1725   000b98 fd7e04               		ld	a, (iy+04h)
  1726   000b9b 32bdff               		ld	(0ffbdh), a
  1727   000b9e fd7e00               		ld	a, (iy+00h)
  1728   000ba1 32beff               		ld	(0ffbeh), a
  1729   000ba4 fde5                 		push	iy
  1730   000ba6 cdbefc               		call	0fcbeh
  1731   000ba9 fde1                 		pop	iy
  1732   000bab e1              fbab:		pop	hl
  1733   000bac cde3f9               		call	0f9e3h
  1734   000baf 1600                 		ld	d, 00h
  1735   000bb1 cd6cf6               		call	0f66ch
  1736   000bb4 c33cf0               		jp	0f03ch
  1737   000bb7 9f                   		sbc	a, a
  1738   000bb8 fee2                 		cp	0e2h
  1739   000bba fe1a                 		cp	1ah
  1740   000bbc b0                   		or	b
  1741   000bbd 2835                 		jr	z, fbf4		; (+35h)
  1742   000bbf fe68                 		cp	68h
  1743   000bc1 fe12                 		cp	12h
  1744   000bc3 6a                   		ld	l, d
  1745   000bc4 187a                 		jr	ASMPC+2+07ah	; (+7ah)
  1746   000bc6 fec8                 		cp	0c8h
  1747   000bc8 fe1a                 		cp	1ah
  1748   000bca 58                   		ld	e, b
  1749   000bcb 14                   		inc	d
  1750   000bcc 16fe                 		ld	d, 0feh
  1751   000bce 56                   		ld	d, (hl)
  1752   000bcf fe12                 		cp	12h
  1753   000bd1 35                   		dec	(hl)
  1754   000bd2 0c                   		inc	c
  1755   000bd3 fd7e00               		ld	a, (iy+00h)
  1756   000bd6 b7                   		or	a
  1757   000bd7 c0                   		ret	nz
  1758                          
  1759   000bd8 2a96ff               		ld	hl, (0ff96h)
  1760   000bdb 7c                   		ld	a, h
  1761   000bdc b5                   		or	l
  1762   000bdd c8                   		ret	z
  1763                          
  1764   000bde fde5                 		push	iy
  1765   000be0 d1                   		pop	de
  1766   000be1 010c00               		ld	bc, 000ch
  1767   000be4 edb0                 		ldir
  1768   000be6 c9                   		ret
  1769                          
  1770   000be7 cd28fc               		call	0fc28h
  1771   000bea d8                   		ret	c
  1772                          
  1773   000beb cdd3fb               		call	0fbd3h
  1774   000bee c8                   		ret	z
  1775                          
  1776   000bef cd4afc               		call	0fc4ah
  1777   000bf2 fde5                 		push	iy
  1778   000bf4 e1              fbf4:		pop	hl
  1779   000bf5 11f4c2               		ld	de, 0c2f4h
  1780   000bf8 d5                   		push	de
  1781   000bf9 010c00               		ld	bc, 000ch
  1782   000bfc edb0                 		ldir
  1783   000bfe e1                   		pop	hl
  1784   000bff 114300               		ld	de, 0043h
  1785   000c02 c36cf6               		jp	0f66ch
  1786   000c05 cd28fc               		call	0fc28h
  1787   000c08 d8                   		ret	c
  1788                          
  1789   000c09 cd4afc               		call	0fc4ah
  1790   000c0c cdb9f6               		call	0f6b9h
  1791   000c0f c0                   		ret	nz
  1792                          
  1793   000c10 110c00               		ld	de, 000ch
  1794   000c13 b7                   		or	a
  1795   000c14 ed52                 		sbc	hl, de
  1796   000c16 c0                   		ret	nz
  1797                          
  1798   000c17 cd4afc               		call	0fc4ah
  1799   000c1a 2100c1               		ld	hl, 0c100h
  1800   000c1d fde5                 		push	iy
  1801   000c1f d1                   		pop	de
  1802   000c20 010c00               		ld	bc, 000ch
  1803   000c23 edb0                 		ldir
  1804   000c25 c354fc               		jp	0fc54h
  1805   000c28 3afbc2               		ld	a, (0c2fbh)
  1806   000c2b d631                 		sub	31h
  1807   000c2d fe04                 		cp	04h
  1808   000c2f 3f                   		ccf
  1809   000c30 d8                   		ret	c
  1810                          
  1811   000c31 2600                 		ld	h, 00h
  1812   000c33 6f                   		ld	l, a
  1813   000c34 29                   		add	hl, hl
  1814   000c35 29                   		add	hl, hl
  1815   000c36 29                   		add	hl, hl
  1816   000c37 29                   		add	hl, hl
  1817   000c38 0156ff               		ld	bc, 0ff56h
  1818   000c3b 09                   		add	hl, bc
  1819   000c3c e5                   		push	hl
  1820   000c3d fde1                 		pop	iy
  1821   000c3f fdcb0876             		bit	6, (iy+08h)
  1822   000c43 37                   		scf
  1823   000c44 c8                   		ret	z
  1824                          
  1825   000c45 3299ff               		ld	(0ff99h), a
  1826   000c48 af                   		xor	a
  1827   000c49 c9                   		ret
  1828                          
  1829   000c4a db70            fc4a:		in	a, (70h)
  1830   000c4c cb4f                 		bit	1, a
  1831   000c4e 28fa                 		jr	z, fc4a		; (-06h)
  1832   000c50 3e41                 		ld	a, 41h
  1833   000c52 1802                 		jr	fc56		; (+02h)
  1834   000c54 3e43                 		ld	a, 43h
  1835   000c56 2101c3          fc56:		ld	hl, 0c301h
  1836   000c59 77                   		ld	(hl), a
  1837   000c5a 1600                 		ld	d, 00h
  1838   000c5c c384f6               		jp	0f684h
  1839   000c5f cd4afc               		call	0fc4ah
  1840   000c62 cd9cfc               		call	0fc9ch
  1841   000c65 2100c3               		ld	hl, 0c300h
  1842   000c68 b7                   		or	a
  1843   000c69 ed42                 		sbc	hl, bc
  1844   000c6b e5                   		push	hl
  1845   000c6c eb                   		ex	de, hl
  1846   000c6d 2ab2fc               		ld	hl, (0fcb2h)
  1847   000c70 f3                   		di
  1848   000c71 edb0                 		ldir
  1849   000c73 fb                   		ei
  1850   000c74 e1                   		pop	hl
  1851   000c75 114300               		ld	de, 0043h
  1852   000c78 c36cf6               		jp	0f66ch
  1853   000c7b cd4afc               		call	0fc4ah
  1854   000c7e cdb9f6               		call	0f6b9h
  1855   000c81 c0                   		ret	nz
  1856                          
  1857   000c82 cd9cfc               		call	0fc9ch
  1858   000c85 b7                   		or	a
  1859   000c86 ed42                 		sbc	hl, bc
  1860   000c88 c0                   		ret	nz
  1861                          
  1862   000c89 c5                   		push	bc
  1863   000c8a cd4afc               		call	0fc4ah
  1864   000c8d c1                   		pop	bc
  1865   000c8e 2100c1               		ld	hl, 0c100h
  1866   000c91 ed5bb2fc             		ld	de, (0fcb2h)
  1867   000c95 f3                   		di
  1868   000c96 edb0                 		ldir
  1869   000c98 fb                   		ei
  1870   000c99 c354fc               		jp	0fc54h
  1871   000c9c 3afdc2               		ld	a, (0c2fdh)
  1872   000c9f 4f                   		ld	c, a
  1873   000ca0 0600                 		ld	b, 00h
  1874   000ca2 b7                   		or	a
  1875   000ca3 c0                   		ret	nz
  1876                          
  1877   000ca4 04                   		inc	b
  1878   000ca5 c9                   		ret
  1879                          
  1880   000ca6 cd4afc               		call	0fc4ah
  1881   000ca9 2afdc2               		ld	hl, (0c2fdh)
  1882   000cac 22b2fc               		ld	(0fcb2h), hl
  1883   000caf c354fc               		jp	0fc54h
  1884   000cb2 00                   		nop
  1885   000cb3 00                   		nop
  1886   000cb4 cd4afc               		call	0fc4ah
  1887   000cb7 cd54fc               		call	0fc54h
  1888   000cba 2afdc2               		ld	hl, (0c2fdh)
  1889   000cbd e9                   		jp	(hl)
  1890   000cbe af                   		xor	a
  1891   000cbf d356                 		out	(56h), a
  1892   000cc1 3c                   		inc	a
  1893   000cc2 d354                 		out	(54h), a
  1894   000cc4 3e0b                 		ld	a, 0bh
  1895   000cc6 cd6bf3               		call	0f36bh
  1896   000cc9 ee04                 		xor	04h
  1897   000ccb e684                 		and	84h
  1898   000ccd c29afd               		jp	nz, 0fd9ah
  1899   000cd0 2100c3               		ld	hl, 0c300h
  1900   000cd3 3abcff               		ld	a, (0ffbch)
  1901   000cd6 3c                   		inc	a
  1902   000cd7 47                   		ld	b, a
  1903   000cd8 3676            fcd8:		ld	(hl), 76h
  1904   000cda 23                   		inc	hl
  1905   000cdb 36ed                 		ld	(hl), 0edh
  1906   000cdd 23                   		inc	hl
  1907   000cde 36a3                 		ld	(hl), 0a3h
  1908   000ce0 23                   		inc	hl
  1909   000ce1 3620                 		ld	(hl), 20h
  1910   000ce3 23                   		inc	hl
  1911   000ce4 36fb                 		ld	(hl), 0fbh
  1912   000ce6 23                   		inc	hl
  1913   000ce7 10ef                 		djnz	fcd8		; (-11h)
  1914   000ce9 3ec9                 		ld	a, 0c9h
  1915   000ceb 77                   		ld	(hl), a
  1916   000cec 326600               		ld	(0066h), a
  1917   000cef 23                   		inc	hl
  1918   000cf0 22c3ff               		ld	(0ffc3h), hl
  1919   000cf3 af                   		xor	a
  1920   000cf4 322dff               		ld	(0ff2dh), a
  1921   000cf7 b7                   		or	a
  1922   000cf8 2805                 		jr	z, fcff		; (+05h)
  1923   000cfa 3e4b                 		ld	a, 4bh
  1924   000cfc cd6bf3               		call	0f36bh
  1925   000cff dd2ab6ff        fcff:		ld	ix, (0ffb6h)
  1926   000d03 fd2ab8ff             		ld	iy, (0ffb8h)
  1927   000d07 3abdff               		ld	a, (0ffbdh)
  1928   000d0a 1f                   		rra
  1929   000d0b 3a2fff               		ld	a, (0ff2fh)
  1930   000d0e 3007                 		jr	nc, fd17		; (+07h)
  1931   000d10 ee20                 		xor	20h
  1932   000d12 322fff               		ld	(0ff2fh), a
  1933   000d15 d330                 		out	(30h), a
  1934   000d17 cda4fd          fd17:		call	0fda4h
  1935   000d1a 3a2dff               		ld	a, (0ff2dh)
  1936   000d1d d341                 		out	(41h), a
  1937   000d1f 2ac3ff               		ld	hl, (0ffc3h)
  1938   000d22 f3                   		di
  1939   000d23 3ef4                 		ld	a, 0f4h
  1940   000d25 cd89f3               		call	0f389h
  1941   000d28 3abbff               		ld	a, (0ffbbh)
  1942   000d2b 47                   		ld	b, a
  1943   000d2c 0e43                 		ld	c, 43h
  1944   000d2e cd00c3               		call	0c300h
  1945   000d31 fb                   		ei
  1946   000d32 db40            fd32:		in	a, (40h)
  1947   000d34 cb47                 		bit	0, a
  1948   000d36 20fa                 		jr	nz, fd32		; (-06h)
  1949   000d38 ed5bbfff             		ld	de, (0ffbfh)
  1950   000d3c 2ac1ff               		ld	hl, (0ffc1h)
  1951   000d3f 3abaff               		ld	a, (0ffbah)
  1952   000d42 47                   		ld	b, a
  1953   000d43 dd2ab8ff             		ld	ix, (0ffb8h)
  1954   000d47 dd7e00          fd47:		ld	a, (ix+00h)
  1955   000d4a dd23                 		inc	ix
  1956   000d4c d342                 		out	(42h), a
  1957   000d4e 3a2fff               		ld	a, (0ff2fh)
  1958   000d51 e620                 		and	20h
  1959   000d53 3e88                 		ld	a, 88h
  1960   000d55 2802                 		jr	z, fd59		; (+02h)
  1961   000d57 cbcf                 		set	1, a
  1962   000d59 cd62f3          fd59:		call	0f362h
  1963   000d5c e698                 		and	98h
  1964   000d5e 2814                 		jr	z, fd74		; (+14h)
  1965   000d60 e680                 		and	80h
  1966   000d62 2036                 		jr	nz, fd9a		; (+36h)
  1967   000d64 e5                   		push	hl
  1968   000d65 c5                   		push	bc
  1969   000d66 01fdc2               		ld	bc, 0c2fdh
  1970   000d69 b7                   		or	a
  1971   000d6a ed42                 		sbc	hl, bc
  1972   000d6c c1                   		pop	bc
  1973   000d6d e1                   		pop	hl
  1974   000d6e 3004                 		jr	nc, fd74		; (+04h)
  1975   000d70 73                   		ld	(hl), e
  1976   000d71 23                   		inc	hl
  1977   000d72 72                   		ld	(hl), d
  1978   000d73 23                   		inc	hl
  1979   000d74 13              fd74:		inc	de
  1980   000d75 10d0                 		djnz	fd47		; (-30h)
  1981   000d77 ed53bfff             		ld	(0ffbfh), de
  1982   000d7b 22c1ff               		ld	(0ffc1h), hl
  1983   000d7e 3a2fff               		ld	a, (0ff2fh)
  1984   000d81 e620                 		and	20h
  1985   000d83 c2fffc               		jp	nz, 0fcffh
  1986   000d86 3a2dff               		ld	a, (0ff2dh)
  1987   000d89 3c                   		inc	a
  1988   000d8a 21beff               		ld	hl, 0ffbeh
  1989   000d8d be                   		cp	(hl)
  1990   000d8e daf4fc               		jp	c, 0fcf4h
  1991   000d91 2ac1ff               		ld	hl, (0ffc1h)
  1992   000d94 36ff                 		ld	(hl), 0ffh
  1993   000d96 23                   		inc	hl
  1994   000d97 36ff                 		ld	(hl), 0ffh
  1995   000d99 af                   		xor	a
  1996   000d9a f5              fd9a:		push	af
  1997   000d9b 3eff                 		ld	a, 0ffh
  1998   000d9d 322dff               		ld	(0ff2dh), a
  1999   000da0 d341                 		out	(41h), a
  2000   000da2 f1                   		pop	af
  2001   000da3 c9                   		ret
  2002                          
  2003   000da4 3abaff               		ld	a, (0ffbah)
  2004   000da7 4f                   		ld	c, a
  2005   000da8 dde5                 		push	ix
  2006   000daa e1                   		pop	hl
  2007   000dab 46                   		ld	b, (hl)
  2008   000dac 23                   		inc	hl
  2009   000dad ed5bc3ff             		ld	de, (0ffc3h)
  2010   000db1 cd0bfe          fdb1:		call	0fe0bh
  2011   000db4 10fb                 		djnz	fdb1		; (-05h)
  2012   000db6 46                   		ld	b, (hl)
  2013   000db7 23                   		inc	hl
  2014   000db8 e5                   		push	hl
  2015   000db9 dde1                 		pop	ix
  2016   000dbb 3a2dff          fdbb:		ld	a, (0ff2dh)
  2017   000dbe dd7707               		ld	(ix+07h), a
  2018   000dc1 3a2fff               		ld	a, (0ff2fh)
  2019   000dc4 e620                 		and	20h
  2020   000dc6 3e00                 		ld	a, 00h
  2021   000dc8 2801                 		jr	z, fdcb		; (+01h)
  2022   000dca 3c                   		inc	a
  2023   000dcb dd7709          fdcb:		ld	(ix+09h), a
  2024   000dce fd7e00               		ld	a, (iy+00h)
  2025   000dd1 fd23                 		inc	iy
  2026   000dd3 dd770b               		ld	(ix+0bh), a
  2027   000dd6 dde5                 		push	ix
  2028   000dd8 e1                   		pop	hl
  2029   000dd9 c5                   		push	bc
  2030   000dda cd0bfe          fdda:		call	0fe0bh
  2031   000ddd 10fb                 		djnz	fdda		; (-05h)
  2032   000ddf dd7e0d               		ld	a, (ix+0dh)
  2033   000de2 cdcdfa               		call	0facdh
  2034   000de5 3eff            fde5:		ld	a, 0ffh
  2035   000de7 12                   		ld	(de), a
  2036   000de8 13                   		inc	de
  2037   000de9 0b                   		dec	bc
  2038   000dea 78                   		ld	a, b
  2039   000deb b1                   		or	c
  2040   000dec 20f7                 		jr	nz, fde5		; (-09h)
  2041   000dee 46                   		ld	b, (hl)
  2042   000def 23                   		inc	hl
  2043   000df0 cd0bfe          fdf0:		call	0fe0bh
  2044   000df3 10fb                 		djnz	fdf0		; (-05h)
  2045   000df5 c1                   		pop	bc
  2046   000df6 0d                   		dec	c
  2047   000df7 20c2                 		jr	nz, fdbb		; (-3eh)
  2048   000df9 2ac3ff               		ld	hl, (0ffc3h)
  2049   000dfc 01d827               		ld	bc, 27d8h
  2050   000dff 09                   		add	hl, bc
  2051   000e00 ed52                 		sbc	hl, de
  2052   000e02 44                   		ld	b, h
  2053   000e03 4d                   		ld	c, l
  2054   000e04 62                   		ld	h, d
  2055   000e05 6b                   		ld	l, e
  2056   000e06 13                   		inc	de
  2057   000e07 77                   		ld	(hl), a
  2058   000e08 edb0                 		ldir
  2059   000e0a c9                   		ret
  2060                          
  2061   000e0b c5                   		push	bc
  2062   000e0c 46                   		ld	b, (hl)
  2063   000e0d 23                   		inc	hl
  2064   000e0e 7e                   		ld	a, (hl)
  2065   000e0f 23                   		inc	hl
  2066   000e10 12              fe10:		ld	(de), a
  2067   000e11 13                   		inc	de
  2068   000e12 10fc                 		djnz	fe10		; (-04h)
  2069   000e14 c1                   		pop	bc
  2070   000e15 c9                   		ret
  2071                          
  2072   000e16 0110ff               		ld	bc, 0ff10h
  2073   000e19 0b                   		dec	bc
  2074   000e1a 03                   		inc	bc
  2075   000e1b 00                   		nop
  2076   000e1c 03                   		inc	bc
  2077   000e1d 00                   		nop
  2078   000e1e 01fe01               		ld	bc, 01feh
  2079   000e21 00                   		nop
  2080   000e22 010001               		ld	bc, 0100h
  2081   000e25 00                   		nop
  2082   000e26 010001               		ld	bc, 0100h
  2083   000e29 f7                   		rst	30h
  2084   000e2a 0b                   		dec	bc
  2085   000e2b ff                   		rst	38h
  2086   000e2c 0600                 		ld	b, 00h
  2087   000e2e 01fb02               		ld	bc, 02fbh
  2088   000e31 01f709               		ld	bc, 09f7h
  2089   000e34 ff                   		rst	38h
  2090   000e35 01204e               		ld	bc, 4e20h
  2091   000e38 0c                   		inc	c
  2092   000e39 0c                   		inc	c
  2093   000e3a 00                   		nop
  2094   000e3b 03                   		inc	bc
  2095   000e3c f5                   		push	af
  2096   000e3d 01fe01               		ld	bc, 01feh
  2097   000e40 00                   		nop
  2098   000e41 010001               		ld	bc, 0100h
  2099   000e44 00                   		nop
  2100   000e45 010101               		ld	bc, 0101h
  2101   000e48 f7                   		rst	30h
  2102   000e49 164e                 		ld	d, 4eh
  2103   000e4b 0c                   		inc	c
  2104   000e4c 00                   		nop
  2105   000e4d 03                   		inc	bc
  2106   000e4e f5                   		push	af
  2107   000e4f 01fb02               		ld	bc, 02fbh
  2108   000e52 01f710               		ld	bc, 10f7h
  2109   000e55 4e                   		ld	c, (hl)
  2110   000e56 12                   		ld	(de), a
  2111   000e57 100e                 		djnz	fe67		; (+0eh)
  2112   000e59 0c                   		inc	c
  2113   000e5a 0a                   		ld	a, (bc)
  2114   000e5b 08                   		ex	af, af'
  2115   000e5c 0604                 		ld	b, 04h
  2116   000e5e 02                   		ld	(bc), a
  2117   000e5f 110f0d               		ld	de, 0d0fh
  2118   000e62 0b                   		dec	bc
  2119   000e63 09                   		add	hl, bc
  2120   000e64 07                   		rlca
  2121   000e65 05                   		dec	b
  2122   000e66 03                   		inc	bc
  2123   000e67 010107          fe67:		ld	bc, 0701h
  2124   000e6a 0d                   		dec	c
  2125   000e6b 060c                 		ld	b, 0ch
  2126   000e6d 12                   		ld	(de), a
  2127   000e6e 05                   		dec	b
  2128   000e6f 0b                   		dec	bc
  2129   000e70 11040a               		ld	de, 0a04h
  2130   000e73 1003                 		djnz	fe78		; (+03h)
  2131   000e75 09                   		add	hl, bc
  2132   000e76 0f                   		rrca
  2133   000e77 02                   		ld	(bc), a
  2134   000e78 08              fe78:		ex	af, af'
  2135   000e79 0e04                 		ld	c, 04h
  2136   000e7b 28ff                 		jr	z, ASMPC+1		; (-01h)
  2137   000e7d 0600                 		ld	b, 00h
  2138   000e7f 01fc1a               		ld	bc, 1afch
  2139   000e82 ff                   		rst	38h
  2140   000e83 0b                   		dec	bc
  2141   000e84 03                   		inc	bc
  2142   000e85 00                   		nop
  2143   000e86 03                   		inc	bc
  2144   000e87 00                   		nop
  2145   000e88 01fe01               		ld	bc, 01feh
  2146   000e8b 00                   		nop
  2147   000e8c 010001               		ld	bc, 0100h
  2148   000e8f 00                   		nop
  2149   000e90 010001               		ld	bc, 0100h
  2150   000e93 f7                   		rst	30h
  2151   000e94 0b                   		dec	bc
  2152   000e95 ff                   		rst	38h
  2153   000e96 0600                 		ld	b, 00h
  2154   000e98 01fb02               		ld	bc, 02fbh
  2155   000e9b 01f71b               		ld	bc, 1bf7h
  2156   000e9e ff                   		rst	38h
  2157   000e9f 05                   		dec	b
  2158   000ea0 50                   		ld	d, b
  2159   000ea1 4e                   		ld	c, (hl)
  2160   000ea2 0c                   		inc	c
  2161   000ea3 00                   		nop
  2162   000ea4 03                   		inc	bc
  2163   000ea5 f601                 		or	01h
  2164   000ea7 fc324e               		call	m, 4e32h
  2165   000eaa 0c                   		inc	c
  2166   000eab 0c                   		inc	c
  2167   000eac 00                   		nop
  2168   000ead 03                   		inc	bc
  2169   000eae f5                   		push	af
  2170   000eaf 01fe01               		ld	bc, 01feh
  2171   000eb2 00                   		nop
  2172   000eb3 010001               		ld	bc, 0100h
  2173   000eb6 00                   		nop
  2174   000eb7 010101               		ld	bc, 0101h
  2175   000eba f7                   		rst	30h
  2176   000ebb 164e                 		ld	d, 4eh
  2177   000ebd 0c                   		inc	c
  2178   000ebe 00                   		nop
  2179   000ebf 03                   		inc	bc
  2180   000ec0 f5                   		push	af
  2181   000ec1 01fb02               		ld	bc, 02fbh
  2182   000ec4 01f735               		ld	bc, 35f7h
  2183   000ec7 4e                   		ld	c, (hl)
  2184   000ec8 010e03               		ld	bc, 030eh
  2185   000ecb 1005                 		djnz	ASMPC + 2 + 5	;(+05h)
  2186   000ecd 12                   		ld	(de), a
  2187   000ece 07                   		rlca
  2188   000ecf 14                   		inc	d
  2189   000ed0 09                   		add	hl, bc
  2190   000ed1 160b                 		ld	d, 0bh
  2191   000ed3 180d                 		jr	fee2		; (+0dh)
  2192   000ed5 1a                   		ld	a, (de)
  2193   000ed6 02                   		ld	(bc), a
  2194   000ed7 0f                   		rrca
  2195   000ed8 04                   		inc	b
  2196   000ed9 110613               		ld	de, 1306h
  2197   000edc 08                   		ex	af, af'
  2198   000edd 15                   		dec	d
  2199   000ede 0a                   		ld	a, (bc)
  2200   000edf 17                   		rla
  2201   000ee0 0c                   		inc	c
  2202   000ee1 19                   		add	hl, de
  2203   000ee2 011209          fee2:		ld	bc, 0912h
  2204   000ee5 1a                   		ld	a, (de)
  2205   000ee6 110819               		ld	de, 1908h
  2206   000ee9 1007                 		djnz	ASMPC + 2 + 7	; (+07h)
  2207   000eeb 180f                 		jr	ASMPC + 2 + 15	; (+0fh)
  2208   000eed 0617                 		ld	b, 17h
  2209   000eef 0e05                 		ld	c, 05h
  2210   000ef1 160d                 		ld	d, 0dh
  2211   000ef3 04                   		inc	b
  2212   000ef4 15                   		dec	d
  2213   000ef5 0c                   		inc	c
  2214   000ef6 03                   		inc	bc
  2215   000ef7 14                   		inc	d
  2216   000ef8 0b                   		dec	bc
  2217   000ef9 02                   		ld	(bc), a
  2218   000efa 13                   		inc	de
  2219   000efb 0a                   		ld	a, (bc)
  2220                          
  2221   000efc 00000000        		dw	0, 0
  2222                          ;--------------------------------------------------
  2223                          ; Workarea (Const + Vars) copied from ROM
  2224                          ;--------------------------------------------------
  2225   000f00 0000000000000000ff00:		dw	0, 0, 0, 0
  2226   000f08 0000000000000000		dw	0, 0, 0, 0
  2227   000f10 0000000000000000ff10:		dw	0, 0, 0, 0
  2228   000f18 0000000000000000		dw	0, 0, 0, 0
  2229                          
  2230   000f20 ffffffff00000000ff20:		db	0FFh, 0FFh, 0FFh, 0FFh, 000h, 000h, 000h, 000h
  2231   000f28 1010101000ff0100		db	010h, 010h, 010h, 010h, 000h, 0FFh, 001h, 000h
  2232   000f30 0000320a00000000		db	000h, 000h, 032h, 00Ah, 000h, 000h, 000h, 000h
  2233   000f38 2108            ff38:		dw	devicetab
  2234   000f3a bef7            ff3a:		dw	0f7beh
  2235   000f3c e1f7            ff3c:		dw	0F7e1h
  2236   000f3e 020d            ff3e:		db	002h, 00Dh
  2237   000f40 0a000000003c0080		db	00Ah, 000h, 000h, 000h, 000h, 03Ch, 000h, 080h
  2238   000f48 00b7fb00c5ff0f  		db	000h, 0B7h, 0FBh, 000h, 0C5h, 0FFh, 00Fh
  2239                          
  2240                          ;--------------------------------------------------
  2241                          ; set to zero in startup code until 0ffffh
  2242                          ;--------------------------------------------------
  2243                          ;ff2a:		db	73h
  2244                          ;     		nop
  2245                          ;     		nop
  2246                          ;     		nop
  2247                          ;     		nop
  2248                          ;     		nop
  2249                          ;     		nop
  2250                          ;     		nop
  2251                          ;ff33:     	nop
  2252                          ;     		nop
  2253                          ;     		nop
  2254                          ;     		nop
  2255                          ;		db	"SALLY 1 Rev 1.01"
  2256                          
